\chapter{Set Theory}
\label{cha:set-math}

Our conception of sets as types with simple homotopy structure, cf.\
\autoref{sec:basics-sets}, is at odds with the Zermelo-Frankel sets which form a
cumulative hierarchy. For many purposes the homotopy-theoretic sets are just as good as
the Zermelo-Fraenkel ones, but there are also important differences. We address these in
the present chapter. 

This chapter has three parts. First we show that constructively $\set$ has pleasant categorical structure: it is a
$\Pi W$-pretopos. This part only focuses on the dimension. In the next part we will concentrate on the set/class distinction. Algebraic Set
Theory is the natural framework for doing so. Finally, we show that the theory of ordinals and cardinals from classical set theory can
naturally be developed by considering sets with isomorphisms as equalities. This equality is, of course, precisely the one we obtain from
the univalence axiom.

\section{$\set$ is a $\Pi$W-pretopos}
In the presence of truncation, the logic of type theory becomes regular.
We can introduce existential quantification of a dependent type $P$ over $A$
by
\begin{equation*}
\exists(x:A),\ P(x) := \big\|\sum(x:A),\ P(x)\big\|.
\end{equation*}
In this section we will show that with trunctaction, $\set$ becomes
a regular 1-category. Thus, we will show that
\begin{enumerate}
\item $\set$ is finitely complete.
\item The kernel pair $\pi_1,\pi_2:\sum(x,y:A),\ f(x)= f(y)\to A$ of any
      function has a coequalizer.
\item Pullbacks of coequalizers are again coequalizers.
\end{enumerate}
The obvious candidate for coequalizer of the kernel pair of a function is the
image of the function. To prove that it is, we will use unique choice. Using unique
choice we can find a function out of the image as indicated by the diagram
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {\sum(x,y:A),\ f(x)\leadsto f(y) & A & \mathsf{im}(f) \\ & & X \\};
\draw[ar] ([yshift=.5ex]m-1-1.east) -- node[above] {$\pi_1$} ([yshift=.5ex]m-1-2.west);
\draw[ar] ([yshift=-.5ex]m-1-1.east) -- node[below] {$\pi_2$} ([yshift=-.5ex]m-1-2.west);
\draw[ar] (m-1-2) -- node[above] {$\tilde{f}$} (m-1-3);
\draw[ar] (m-1-2) -- node[auto,swap] {$g$} (m-2-3);
\draw[ar,densely dotted] (m-1-3) -- (m-2-3);
\end{tikzpicture}
\end{equation*}
whenever $g$ coequalizes $\pi_1$ and $\pi_2$. In our approach, the result 
that the image of a function $f$ is the coequalizer
of its kernel pair is a consequence of the principle of unique choice, 
which we will also prove.

To show that $\set$ is exact, we need to show in addition that every
equivalence relation is effective. In other words, given an equivalence
relation $R:A\to A\to\prop$, there is a coequalizer $c_R$ of the pair
$\pi_1,\pi_2:\sum(x,y:A),\ R(x,y)\to A$ and, moreover, the $\pi_1$ and $\pi_2$
for the kernel pair of $c_R$.

We consider the 1-category $\mathsf{EqRel}$. 
This is useful when we want to compare the categories $\set$ and $\mathsf{EqRel}$. We will show that we have
a quotient functor $\mathsf{EqRel}\to\set$ which is moreover left
adjoint to the inclusion. This adjunction is in general not an equivalence. We will show that if the
surjective functions between sets split, then propositions are decidable.

\section{The image of a function}
\note{BS:This needs work.}
The truncations allow us to define a stable factorization
system\footnote{\url{http://uf-ias-2012.wikispaces.com/file/view/images.pdf/401765624/images.pdf}}.
In fact, this generalizes to reflective subuniverses; see~\autoref{subsec:reflective-subuniverses}.
We will only consider the factorization system given by $(-1)$-truncation.
This defines a stable orthogonal factorization system $(\mathcal{E},
\mathcal{M})$ on $\set$: every map factors as an epimorphism followed by a 
monomorphism and this factorization is stable under pullback.
We first define these notions:
\begin{defn}
Let $f:A\to B$ be a function between $\set$s. It is \emph{surjective} if
\begin{equation*}
\mathsf{surj}(f)\defeq\prod(b:B),\ \|\hfiber{f}b\|.
\end{equation*}
A monomorphism is a functions with contractible homotopy fibers, i.e.\ if there is a term of type
\begin{equation*}
\mathsf{inj}(f)\defeq\prod(a:A),\ \mathsf{isContr}(\hfiber{f}{f(a)}).
\end{equation*}
\end{defn}

We remark that $f:A\to B$ is a monomorphism if and only if the function
\begin{equation*}
\lambda a.\pair{a,a,\idfunc{f(a)}}:A\to A\times_B A
\end{equation*}
is an equivalence.

The injective functions are of course the monomorphisms of
$\set$, which we can also define via a pullback diagram, but we will not do that here.

\begin{defn}
Let $f:A\to B$ be a function between $\set$s. Define
\begin{equation*}
\im(f):=\sum(b:B),\ \|\hfiber{f}b\|
\end{equation*}
We define the functions $\tilde{f}:A\to\im(f)$ and $i_f:\im(f)\to B$ by
\begin{align*}
\tilde{f} & := \lambda a.\pair{f(a),\pi(a,\idfunc{f(a)})}\\
i_f & := \pi_1.
\end{align*}
\end{defn}

\begin{lem}
Then $\tilde{f}$ is surjective and $i_f$ is mono.
\end{lem}

We the insights from~\autoref{subsec:reflective-subuniverses} we can have a look at coequalizers
in $\set$. Let $D$ be the diagram $f,g:A\to B$.
The general (homotopy) colimit of $D$ does not have the quotient-like properties as it would
have in the category $\set$. For instance, the coequalizer of
$\mathsf{unit}\rightrightarrows\mathsf{unit}$ is the circle. Nevertheless,
the $0$-truncation of the circle is again $\mathsf{unit}$, which is the
expected coequalizer in $\set$. Thus we get

\begin{defn}
Let $A$ and $B$ be sets and let $f,g:A\to B$.
We denote the set-coequalizer of $f$ and $g$ by $c_{f,g}:B\to B/_{f,g}$. A
\emph{regular epimorphism} is a function between sets which is a coequalizer.
\end{defn}

\begin{lem}
Let $f,g:A\to B$ be functions between sets $A$ and $B$. The 
{set-co}equalizer $c_{f,g}:B\to B/_{f,g}$ has the property that
\begin{equation*}
\prod\{C:\set\}(h:B\to C)(H:h\circ f\sim h\circ g),\ 
\mathsf{isContr}\big(\sum(k:B/_{f,g}\to C),\ k\circ c_{f,g}\sim h\big).
\end{equation*}
\end{lem}

As explained in~\autoref{subsec:reflective-subuniverses}, this is a general phenomenon, the 0-truncated colimits behave as expected.

\note{TODO}
We need to prove that epis are surjective. We use the pinciple of unique choice~\autoref{cor:UC}. 

\begin{thm}\label{thm:set_regular}
The category $\set$ is regular.\note{Tdo}
\end{thm}

\begin{proof}
$\set$ has all limits, so it is finitely complete. 
Proposition \ref{prop:images_are_coequalizers} gives
that the kernel pair of each function has a coequalizer.
Lemma \ref{lem:pb_of_coeq_is_coeq} gives that
coequalizers are stable under pullbacks.
\end{proof}


\section{Quotients}
\label{sec:quotients}

\note{BS:Work in progress}

We present two constructions of a quotient by a $\prop$-valued equivalence relation $R$. 
The first one uses as a higher inductive type. We freely add a path $x= y$ whenever $x$ 
and $y$ are related by $R$ and we truncate the quotient to become a set.
Instead of giving the truncated higher inductive definition, we use the coequalizer which was defined above.

\begin{defn}
Let $A$ be a set and let $R:A\to A\to\mathsf{Prop}$ be a binary relation over
$A$, not necessarily an equivalence relation. 
We define $A/R$ to be the coequalizer of the two projections
$\pi_1,\pi_2:\sum(x,y:A),\ R(x,y)\to A$ in $\set$.
\end{defn} 

One can prove that quotients have all the expected properties; see~\ref{RijkeSpitters}.

\subsection{Voevodsky's impredicative quotients}\label{sec:resizing}
The second solution is due to Voevodsky~\cite{pelayo2013preliminary}.
He defines the quotient $A//R $ as the type of equivalence classes of $R$, 
i.e.\ as the image of $R$ in $A\to\mathsf{Prop}$. This gives a direct
construction of quotients, but it requires a resizing rule. We fix an equivalence relation $\pairr{A,R}$.

\begin{defn}
A predicate $P:A\to\mathsf{Prop}$ is said to be an equivalence class with 
respect to $R $ if there is a term of type
\begin{equation*}
\mathsf{isEqClass}(R ,P):=\sum(x:A)\prod(y:A),\ R (x,y)\simeq P(y)
\end{equation*}
\end{defn}

\begin{defn}\label{def:VVquotient}
We define
\begin{equation*}
A/\!\!/ R :=\sum(P:A\to\mathsf{Prop}),\ \|\mathsf{isEqClass}(R ,P)\|.
\end{equation*}
\end{defn}

Using univalence on propositions, the following is an easy consequence of the definition:

\begin{lem}
The type $A/\!\!/ R $ is equivalent to $\im(R)$.
\end{lem}

In proposition~\ref{prop:images_are_coequalizers} we have shown that images are
coequalizers. In particular, we immediately get the coequalizer diagram
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {\sum(x,y:A),\ R (x)= R (y) & A & A/\!\!/ R  \\};
\draw[ar] ([yshift=.5ex]m-1-1.east) -- node[above] {$\pi_1$} ([yshift=.5ex]m-1-2.west);
\draw[ar] ([yshift=-.5ex]m-1-1.east) -- node[below] {$\pi_2$} ([yshift=-.5ex]m-1-2.west);
\draw[ar] (m-1-2) -- (m-1-3);
\end{tikzpicture}
\end{equation*}
We can use this to show that any equivalence relation is effective.

\begin{thm}\label{prop:kernels_are_effective}
For any function $f:A\to B$ between any two sets, 
the relation $\ker(f):A\to A\to\type$ given by 
$\ker(f,x,y):=f(x)= f(y)$ is effective. 
\end{thm}

\begin{proof}
We will use that $\im(f)$ is the coequalizer of $\pi_1,\pi_2:
\sum(x,y:A),\ f(x)= f(y)\to A$; 
%we get this equivalence from proposition~\ref{prop:images_are_coequalizers}
. Note that the canonical kernel pair of the function 
$c_f:=\lambda a.\pairr{f(a),\tau_1(\pairr{a,\idfunc{f(a)}})}$ consists 
of the two projections
\begin{equation*}
\pi_1,\pi_2:\big(\sum(x,y:A),\ c_f(x)= c_f(y)\big)\to A.
\end{equation*}
For any $x,y:A$, we have equivalences
\begin{align*}
c_f(x)= c_f(y) & \simeq \sum(p:f(x)= f(y)),\ p\cdot\tau_1(\pairr{x,\idfunc{f(x)}})
=\tau_1(\pairr{y,\id{f(x)}})\\ & \simeq f(x)= f(y),
\end{align*}
where the last equivalence holds because 
$\|\hfiber{f}b\|$ is a proposition for any $b:B$. 
Therefore, we get that
\begin{equation*}
\sum(x,y:A),\ c_f(x)= c_f(y)\simeq\sum(x,y:A),\ f(x)= f(y)
\end{equation*}
and hence we may conclude that $\ker f$ is an effective relation 
for any function $f$.
\end{proof}

\begin{thm}
Equivalence relations are effective and there is an equivalence $A/R \simeq A/\!\!/ R $. 
\end{thm}

\begin{proof}
We need to analyze the coequalizer diagram
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {\sum(x,y:A),\ R (x)= R (y) & A & A/\!\!/ R  \\};
\draw[ar] ([yshift=.5ex]m-1-1.east) -- node[above] {$\pi_1$} ([yshift=.5ex]m-1-2.west);
\draw[ar] ([yshift=-.5ex]m-1-1.east) -- node[below] {$\pi_2$} ([yshift=-.5ex]m-1-2.west);
\draw[ar] (m-1-2) -- (m-1-3);
\end{tikzpicture}
\end{equation*}
By the univalence axiom, the space $R (x)= R (y)$ is equivalent to the space of homotopies from $R (x)$ to $R (y)$, which is
equivalent to $\prod(z:A),\ R (x,z)\simeq R (y,z)$. Since $R $ is an equivalence relation, the latter space is equivalent to $R (x,y)$. To
summarize, we get that $(R (x)= R (y))\simeq R (x,y)$, so $R $ is effective since it is equivalent to an effective relation. Also,
the diagram
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {\sum(x,y:A),\ R (x,y) & A & A/\!\!/ R  \\};
\draw[ar] ([yshift=.5ex]m-1-1.east) -- node[above] {$\pi_1$} ([yshift=.5ex]m-1-2.west);
\draw[ar] ([yshift=-.5ex]m-1-1.east) -- node[below] {$\pi_2$} ([yshift=-.5ex]m-1-2.west);
\draw[ar] (m-1-2) -- (m-1-3);
\end{tikzpicture}
\end{equation*}
is a coequalizer diagram. Since coequalizers are unique up to equivalence, it follows that $A/R \simeq A/\!\!/ R $.
\end{proof}

\subsection{Predicativity}
One may wonder about the predicative interpretation of the quotient constructions above.
One could argue that the HIT construction is predicative by considering the interpretation of this
quotient in the setoid model~\cite{Altenkirch1999,coquand2012constructive}. 
In this model the quotient does not raise the universe level. 
A similar observation holds for constructions that can be carried out in the groupoid 
model~\cite{hofmann1998groupoid}. These observations should suffice for the set-level higher inductive 
types we use in the present paper.

Voevodsky~\cite{Universe-poly} has proposed to allow some impredicativity by adding the following resizing rule:
\[a:U_n, p:(\mathsf{isprop}\ a)\vdash (\mathsf{rr}\ a\ p): U_0,\]
where $U_n$ is any universe and $U_0$ is the lowest universe.
Moreover, when lifted to $U_n$, $(\mathsf{rr}\ a\ p)= a$.
Hence, $\mathsf{rr}$ is an equivalence between $\prop_n$ and $\prop_0$. 
Here we assume that $U_0$ is a subuniverse of $U_n$. 
Another axiom resizes each $\prop_n$ to the lowest universe.

The following replacement axiom is derivable from the resizing axiom; see~\cite{Universe-poly}.
\begin{lem}
Let $U$ be a universe and $X:U$, if $f:X\twoheadrightarrow Y$ is a surjection, $Y$ is a set then there exists a $Z:U$ which is
equivalent to $Y$.
\end{lem}
\begin{proof}
Define $Z\defeq X/\!\!/\ker f$ using the type of equivalence classes; see~\ref{def:VVquotient}. 
Then $Z:U$, since $\prop_U$ is in the lowest universe. Finally, we observe that $Z\defeq X/\ker f\simeq\im f\simeq Y$.
\end{proof}

We finish this section with the following observation.

\begin{lem}\label{lem:dec-quotients}
Let $A:\type$ and $R:A\to A\to\bool$. Then $A/\!/\!R$ has decidable equality. In particular, it is a $\set$.
\end{lem}


\subsection{All surjectives split implies decidability of propositions}\label{sec:surj_split}
In this subsection we derive that if all surjective functions between sets have
a section, then for all propositions $A$ we can decide whether $A$ or $\neg A$
holds. This is an adaptation of an old, famous theorem by
Diaconescu and Bishop to homotopy type theory. %; for more information on surjective functions see~\cite{RijkeSpitters}.

We make use of the more general construction of suspension which will be defined in \autoref{sec:suspension}, but we only need
to apply the suspension to propositions. In the case where $A$ is a proposition,
it turns out that the
suspension $\susp(A)$ is equivalent to the quotient $\mathsf{bool}/R$,
where $R$ is the equivalence relation we get by setting
$R(\mathsf{true},\mathsf{false}):= A$. This shall become clear in the proofs
below.

\begin{lem}\label{prop:trunc_of_prop_is_set}
The suspension of a proposition is a set and the path space 
$0=1$ in $\susp(A)$ is equivalent to $A$, for any proposition $A$. 
\end{lem}

\begin{proof}
Let $A$ be a proposition. Using the univalence axiom, we will define a 
dependent type $P:\susp(A)\to\susp(A)\to\type$ with the 
property that $P(x,y)$ is a proposition for each $x,y:\susp(A)$ 
and which turns out to be equivalent to the dependent type 
$\mathsf{Id}_{\susp(A)}$.

We make the following definitions:
\begin{align*}
P(0,0) & \equiv \mathsf{unit} & P(1,0) & \equiv A\\
P(0,1) & \equiv A & P(1,1) & \equiv \mathsf{unit}.
\end{align*}
To show that this gives a dependent type we need to verify that there 
is an equivalence $P(0,0)\simeq P(0,1)$ and an eqivalence 
$P(1,0)\simeq P(1,1)$ for every $a:A$. Since $A$ is assumed to 
be a proposition, this is indeed the case.

To finish the proof we need to show that $P(x,y)\simeq x=y$ 
for every $x,y:\susp(A)$. We can find such a fiberwise equivalence 
by finding a transformation
\begin{equation*}
\tau(y):\prod(x:\susp(A)),\ P(x,y)\to x=y
\end{equation*}
which induces an equivalence 
\begin{equation*}
\big(\sum(x:A),\ P(x,y)\big)\simeq\big(\sum(x:\susp(A)),\ x=y\big)
\end{equation*}
of total spaces, for every $y:\susp(A)$. The latter type 
is contractible, so it suffices to find the mentioned transformation 
and proof that the total space on the left is contractible. We may do 
the first of these tasks by applying the induction principle for 
$\susp(A)$. We make the definitions
\begin{align*}
\tau(0,0) & := \lambda t.\idfunc{0} & \tau(1,0) &:= \lambda a.\alpha(a)^{-1}\\
\tau(0,1) & := \alpha & \tau(1,1) &:= \lambda t.\idfunc{1}.
\end{align*}
To find a path $\alpha(a)\cdot\tau(0,0)=\tau(0,1)$ for $a:A$, 
note that because $A$ is a proposition there are paths
\begin{equation*}
(\alpha(a)\cdot\tau(0,0))(x)=\tau(0,0,x)\bullet\alpha(a)^{-1}
=\alpha(a)^{-1}= \alpha(x)^{-1}. 
\end{equation*}
Thus we get the requested path from function extensionality. Likewise, 
we obtain a path $\tau(0)=\tau(1)$ for every $a:A$, 
which finishes the construction of $\tau$.

The last thing to do to finish the proof is to show that 
$\sum(x:A),\ P(x,y)$ is contractible for every $y:\susp(A)$. 
Since $\mathsf{isContr}(X)$ is a proposition for every type $X$, 
we only need to show that $\sum(x:A),\ P(x,0)$ and 
$\sum(x:\susp(A)),\ P(x,1)$ are contractible. 
They are clearly equivalent, so we only verify the contractibility 
of the latter. The obvious candidate for the center of contraction 
is $\pair{1,\mathsf{tt}}$, thus we need to show that there is a 
function $c$ of type
\begin{equation*}
\prod(x:\susp(A))(u:P(x,1)),\ \langle{x,u}\rangle=\langle{1,\mathsf{tt}}\rangle.
\end{equation*}
We do this again by induction on $x$. To define $c(0)$, note that 
for any $a:A$, we have the path $\alpha(a):0= 1$. Since 
$\mathsf{unit}$ is contractible we will automatically get a path 
$\alpha(a)\cdot u=\mathsf{tt}$. The definition of $c(1)$ is obvious. 
Then we get, for $a:A$, a path 
$(\alpha(a)\cdot c(0))(\mathsf{tt})= c(1,\mathsf{tt})$ 
because $\susp(A)$ is contractible when $A$ is contractible. 
This gives us a path $\alpha(a)\cdot c(0)= c(1)$ and finishes 
the proof by induction that $\sum(x:A),\ P(x,1)$ is contractible.
\end{proof}

\begin{defn}
Suppose $A$ is a type. We define
\begin{equation*}
\mathsf{isDecidable}(A)\equiv  A+\neg A
\end{equation*}
\end{defn}

\begin{thm}[Bishop/Diaconescu]\label{prop:1surj_to_surj_to_pem}
Suppose that all surjections between sets split. Then for all $A:\prop$,
$\mathsf{isDecidable}(A)$. 
\end{thm}

\begin{proof}
Consider the function $\pi:\mathsf{bool}\to\susp(A)$ defined by 
$\pi(\mathsf{true})\equiv 1$ and $\pi(\mathsf{false})\equiv 0$. 
The first thing we will do is show that $\pi$ is surjective, 
i.e.\ that there is a function of type
\begin{equation*}
\prod(x:\susp(A)),\ \|\hfiber\pi{x}\|.
\end{equation*}
Note that we have the terms 
$\langle{\mathsf{false},\idfunc{0}}\rangle:\hfiber\pi0$ 
and $\langle{\mathsf{true},\idfunc{1}}\rangle:\hfiber\pi1$. 
Since $\|\hfiber\pi{x}\|$ is a proposition for each 
$x:\susp(A)$, this gives us the proof by induction of 
the surjectivity of $\pi$.

By proposition~\ref{prop:trunc_of_prop_is_set} the suspension of 
a proposition is always a set, so our assumption gives us a 
section $g:\susp(A)\to\mathsf{bool}$ of $\pi$. 
Since $\mathsf{bool}$ has decidable equality, there is a term of type 
\begin{equation*}
\mathsf{isDecidable}(g(\pi(\mathsf{true}))= g(\pi(\mathsf{false})))
\end{equation*}
and since $g$ is a section of $\pi$ it follows that there is a term of type
\begin{equation*}
\mathsf{isDecidable}(\pi(\mathsf{true})=\pi(\mathsf{false}))
\end{equation*}
Now we see that it is enough to show that 
$\pi(\mathsf{true})= \pi(\mathsf{false})$ is equivalent to $A$. 
This we also obtained in proposition~\ref{prop:trunc_of_prop_is_set}.
\end{proof}

\section{Algebraic Set Theory}
\note{Steve Awodey}


\section{Excluded Middle and the Axiom of Choice}
\label{sec:excl-middle-axiom}

\textbf{TODO:} Discuss excluded middle and choice, state that the appropriate versions are
consistent, so me may assume them. Prove that choice implies excluded middle?

\section{Sets and Classes}
\label{sec:sets-classes}

\textbf{TODO:} Discuss the role of universes as classes-of-classes-of-classes, or
alternatively as inaccessible sets.

\section{Powersets}
\label{sec:powersets}

\textbf{TODO:} Point out that we get \textbf{powerclasses} when we consider $X \to \prop$, that the
powerset axiom is about powerclasses being sets, that this is equivalent to $\prop$ being
a set, so resizing comes into play.

For a set $X$, we speak of predicates $Y:X\to \prop$ equivalently as \textbf{subsets} of $X$, and sometimes write $x\in Y$ to mean $Y(x)$.
We will also use the set-builder notation for such subsets:
\[ \setof{x:X | P } \defeq \lambda x.P \]
Univalence for \prop, plus function extensionality, implies that such subsets are \emph{extensional} in the usual sense of set theory:
\[ (Y_1 = Y_2) \leftrightarrow \Big(\prd{x:X} (x\in Y_1) \leftrightarrow (x\in Y_2)\Big) \]
Note that both sides of this equivalence are mere propositions.

We define the \textbf{power set} of $X$ to be
\begin{align*}
  \mathcal{P} X &\defeq X\to \prop
\end{align*}
Likewise, we define the subset of inhabited subsets in $X$ to be
\begin{align*}
  \mathcal{P}_+ X &\defeq \setof{P:X\to \prop | \brck{(\exists x:X), P(x)}}
\end{align*}
Assuming excluded middle, we have $\mathcal{P}_+ X \cong \setof{P:X\to \prop | P \neq (\lambda x.\bot)}$ and also $\mathcal{P} X \cong \mathcal{P}_+ X + \unit$.

For $Y:\mathcal{P}X$, we write $X\setminus Y \defeq \setof{x:X | x\notin Y}$.
Similarly, we have unions $Y_1 \cup Y_2$, intersections $Y_1 \cap Y_2$, and so on.

\section{The cumulative hierarchy}
\label{sec:cumulative-hierarchy}

Construction of $V$ as a HIT, mimicking Peter Aczel's construction of a type-theoretic
model of CZF.


\input{ordcard}

% Local Variables:
% TeX-master: "main"
% End:
