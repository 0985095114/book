\newcommand{\vset}{\mathsf{set}}  % point constructor for cummulative hierarchy V

\chapter{Set Theory}
\label{cha:set-math}

Our conception of sets as types with particularly simple homotopical character, cf.\
\autoref{sec:basics-sets}, is quite different from Zermelo-Frankel sets, which form a
cumulative hierarchy. For many purposes the homotopy-theoretic sets are just as good as
the Zermelo-Fraenkel ones, but there are also important differences. We address these in
the present chapter. 

This chapter has three parts. First, following~\cite{RijkeSpitters}, we show that the category $\set$ of all $0$-types and maps between them has (most of) the usual properties of the category of sets; i.e.\ technically speaking, it is a ``$\Pi W$-pretopos".  We then  consider the possibility of constructing a cumulative hierarchy of sets, equipped with a binary membership relation. Algebraic set theory is a convenient framework for this construction. Finally, we show that the theory of ordinals and cardinals from classical set theory can be developed in a natural way by considering sets with isomorphisms as equalities. This equality is, of course, precisely the one we obtain from the univalence axiom.

%\section{\texorpdfstring{$\set$}{Set} is a \texorpdfstring{$\Pi$}{Î }W-pretopos}
\section{The category of sets}
\label{sec:piw-pretopos}

%We will show that $\set$ is a $\Pi$W-pretopos. 
We begin by proving that $\set$ is a \emph{regular} category, i.e.:
%
\begin{enumerate}
\item $\set$ is finitely complete.
\item The kernel pair $\pi_1,\pi_2: (\sm{x,y:A} f(x)= f(y)) \to A$ of any
      function $f : A \to B$ has a coequalizer.
\item Pullbacks of regular epimorphisms are again regular epimorphisms.
\end{enumerate}
%
Recall that an epi is called \emph{regular} if it is the coequalizer of \emph{some} pair of maps; so in (iii) the pullback of a coequalizer is required to again be a coequalizer, but not necessarily of the pulled-back pair. 

The obvious candidate for the coequalizer of the kernel pair of a function is the \emph{image} of the function, to be defined below.
%
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {\sm{x,y:A} f(x)= f(y) & A & \mathsf{im}(f) \\ & & B \\};
\draw[ar] ([yshift=.5ex]m-1-1.east) -- node[above] {$\pi_1$} ([yshift=.5ex]m-1-2.west);
\draw[ar] ([yshift=-.5ex]m-1-1.east) -- node[below] {$\pi_2$} ([yshift=-.5ex]m-1-2.west);
\draw[ar] (m-1-2) -- node[above] {$\tilde{f}$} (m-1-3);
\draw[ar] (m-1-2) -- node[auto,swap] {$f$} (m-2-3);
\draw[ar,densely dotted] (m-1-3) -- (m-2-3);
\end{tikzpicture}
\end{equation*}

We will show that the image of a function $f$ is indeed the coequalizer of its kernel pair, that the resulting map from the image into the codomain $B$ is a monic, and that the resulting (regular) epi-mono factorization is stable under pullback.

\subsection{The image of a function}
\label{sec:image}

The truncations introduced in~\autoref{subsec:reflective-subuniverses} allow us to define the stable factorization
system we seek.
%\footnote{\url{http://uf-ias-2012.wikispaces.com/file/view/images.pdf/401765624/images.pdf}}
 Specifically, we use the $(-1)$-truncation $\|X\|$ to define a stable orthogonal factorization system  on $\set$: every map factors as an ``surjection" followed by an ``injection", and this factorization is stable under pullback.
We first define these notions:

We can use the logical notation from \autoref{defn:logical-notation}; in particular, below we can also write $\fall{b:B} \exis{a:A} f(a)=b$ for $\prd{b:B} \|\hfiber{f}b\|$.

\begin{defn}
A function $f:A\to B$  between sets is \emph{surjective} if
\begin{align*}
\mathsf{surj}(f) &\defeq\prd{b:B} \|\hfiber{f}b\| \\
&= \fall{b:B} \exis{a:A}f(a)=b
\end{align*}

%In general, the monomorphisms of types are functions with contractible homotopy fibers over images of points in $A$; thus we define
%\note{Move to \autoref{sec:mono-epi}?}

A function $f:A\to B$  between sets is \emph{injective} if
\begin{align*}
\mathsf{inj}(f) &\defeq\prd{a:A} \mathsf{isContr}(\hfiber{f}{f(a)})\\
	&= \fall{a,a':A} f(a) = f(a') \Rightarrow a=a'
\end{align*}
\end{defn}

\noindent The injective functions can be seen to be the monomorphisms of $\set$, which can also be characterized as those $f:A\to B$ such that the function
\begin{equation*}
  \lam{a} \pairr{a,a,\refl{f(a)}}:A\to A\times_B A
\end{equation*}
is an equivalence.

\begin{defn}
Let $f:A\to B$ be a function between sets. Define the \emph{image} of $f$ by: 
\begin{align*}
\im(f) &\defeq\sm{b:B} \|\hfiber{f}b\|\\
	&= \sm{b:B} \|\sm{a:A}f(a)=b\|
\end{align*}
Moreover, define the functions $\tilde{f}:A\to\im(f)$ and $i_f:\im(f)\to B$ by
\begin{align*}
  \tilde{f} & \defeq \lam{a} \pairr{f(a),|\pairr{a,\refl{f(a)}}|}\\
i_f & \defeq \pi_1.
\end{align*}
\end{defn}

\begin{lem}
As just defined, $\tilde{f}$ is surjective and $i_f$ is injective.
\end{lem}

Next, we use the insights from~\autoref{subsec:reflective-subuniverses} and consider coequalizers
in $\set$. The coequalizer of a pair of maps in $\set$ is defined as the 0-truncation of a general coequalizer.  Given a pair of maps $f,g:A\to B$, the general, non-truncated, pushout does not have the quotient-like properties expected in the category $\set$.  For instance, the untruncated coequalizer of $\unit\rightrightarrows\unit$ is the circle. Nevertheless, the $0$-truncation of the circle is again $\unit$, which is the expected coequalizer in $\set$. Thus we set

\begin{defn}
Let $A$ and $B$ be sets and let $f,g:A\to B$.
We define the \emph{set-coequalizer} of $f$ and $g$ to be the $0$-truncation of their general coequalizer, as defined in \autoref{sec:colimits},
\[
c_{f,g}:B\to B\sslash(f=g) \defeq \|B/(f=g)\|_0.
\]
\end{defn}

Recall from \autoref{defn:homotopy} the notation $f \sim g$ for homotopy between functions.

\begin{lem}
Let $f,g:A\to B$ be functions between sets $A$ and $B$. The 
{set-co}equalizer $c_{f,g}:B\to B\sslash(f=g)$ has the property that, for any set $C$, any $h:B\to C$ with $h\circ f\sim h\circ g$, the type\begin{equation*}
\sm{k:B\sslash(f=g)\to C} k\circ c_{f,g}\sim h
\end{equation*}
is contractible.
\end{lem}
%
\noindent As explained in~\autoref{subsec:reflective-subuniverses}, this is a general phenomenon, the 0-truncated colimits behave as expected.

We next connect regular epis and surjective functions; for this, we use the principle of unique choice; see~\autoref{cor:UC}. 

\begin{defn}
Let $f:A\to B$ be a function between sets. Define
\begin{align*}
\mathsf{epi}(f) & \defeq \prd{X:\set}{g,h:B\to X}
(g\circ f\sim h\circ f)\to (g\sim h)\\
\mathsf{epi}'(f) & \defeq\prd{X:\set}{g:B\to X}
\mathsf{isContr}\big(\sm{h:B\to X} g\circ f\sim h\circ f\big).
\end{align*}
\end{defn}

Note that $\mathsf{epi}(f)$ is the usual notion of epimorphism while the
notion $\mathsf{epi}'(f)$ seems to be stronger. The latter seems to be the right notion for general types.

\begin{lem}\label{epis-surj}
For any function $f:A\to B$ between sets, the following are equivalent:
\begin{enumerate}
\item $f$ is an epimorphism, i.e.\ we have $\mathsf{epi}(f)$.
\item We have $\mathsf{epi}'(f)$.
\item Consider the pushout diagram
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {A & B \\ \mathsf{unit} & C_f \\};
\draw[ar] (m-1-1) -- node[above] {$f$} (m-1-2);
\draw[ar] (m-1-2) -- node[right] {$\iota$} (m-2-2);
\draw[ar] (m-1-1) -- (m-2-1);
\draw[ar] (m-2-1) -- node[below] {$t$} (m-2-2);
\end{tikzpicture}
\end{equation*}
in $\set$ defining the mapping cone. The type $C_f$ is contractible.
\item $f$ is surjective.
\end{enumerate}
\end{lem}

\begin{proof}
Let $f:A\to B$ be a function between sets.
To show that $\mathsf{epi}(f)\to\mathsf{epi}'(f)$, assume $f$ is an epimorphism,
let $X$ be a set and let $g:B\to X$ be a function. Then we find
\begin{equation*}
\pairr{g,\refl{g\circ f}}:\sm{h:B\to X} g\circ f\sim h\circ f.
\end{equation*}
Thus, to show that $\sm{h:B\to X} g\circ f\sim h\circ f$ 
is contractible we need to show that
\begin{equation*}
\prd{h:B\to X}{K:g\circ f\sim h\circ f}\sm{L:g\sim h} K\sim L\circ f.
\end{equation*}
Note that $K\sim L\circ f$ is contractible since $X$ is assumed to be a set,
hence it suffices to show that
\begin{equation*}
\prd{h:B\to X} (g\circ f\sim h\circ f)\to (g\sim h).
\end{equation*}
This follows at once from the assumption that $f$ is an epimorphism.

To show that $\mathsf{epi}'(f)\to\mathsf{isContr}(C_f)$, suppose that
$\mathsf{epi}'(f)$. The basic constructor of $C_f$ corresponding to
$\mathsf{unit}\to C_f$ gives us an element $t:C_f$. We have to show that
\begin{equation*}
\prd{x:C_f} x= t.
\end{equation*}
Note that $x= t$ is a proposition, hence we can use induction on
$C_f$: it suffices to find
\begin{align*}
I_0 & : \prd{b:B} \iota(b)= t\\
I_1 & : \prd{a:A} \opp{\alpha_1(a)} \ct I_0(f(a))=\refl{t}.
\end{align*}
where $\alpha_1:\prd{a:A} \iota(f(a))= t$ is a basic constructor
of $C_f$. Note that $\alpha_1$ is a homotopy from $\iota\circ f$ to
$\mathsf{const}_t\circ f$, so we find the terms
\begin{equation*}
\pairr{\iota,\refl{\iota\circ f}},\pairr{\mathsf{const}_t,\alpha_1}:
\sm{h:B\to C_f} \iota\circ f\sim h\circ f.
\end{equation*}
By the assumption of $\mathsf{epi}'(f)$, it follows that there is a path
\begin{equation*}
\gamma:\pairr{\iota,\refl{\iota\circ f}}=\pairr{\mathsf{const}_t,\alpha_1}
\end{equation*}
Hence, we may define $I_0(b)\defeq \happly(\projpath1(\gamma),b):\iota(b)=t$.
We also have
\[\projpath2(\gamma) : \trans{\projpath1(\gamma)}{\refl{\iota\circ f}} = \alpha_1. \]
This transport involves precomposition with $f$, which commutes with $\happly$.
Thus, from transport in path types we obtain $I_0(f(a)) = \alpha_1(a)$ for any $a:A$, which gives us $I_1$.

To show that $\mathsf{isContr}(C_f)\to\mathsf{surj}(f)$, assume $\mathsf{isContr}(C_f)$.
We first construct a dependent type $P:C_f\to\prop$ by recursion on $C_f$, which is valid since \prop is a set.
On the point constructors, we define
\begin{align*}
P(t) & \defeq \mathsf{unit}\\
P(\iota(b)) & \defeq \brck{\hfiber{f}b}.
\end{align*}
To complete the construction of $P$, it remains to give a path $\brck{\hfiber{f}{f(a)}} =_\prop \unit$ for all $a:A$.
However, $\brck{\hfiber{f}{f(a)}}$ is inhabited by $(f(a),\refl{f(a)})$.
Since it is a mere proposition, this means it is contractible --- and thus equivalent, hence equal, to \unit.
This completes the definition of $P$.
Now, since $C_f$ is assumed to be contractible, it follows that $P(x)$ is equivalent to $P(t)$ for any $x:C_f$.
In particular, $P(\iota(b))\jdeq \brck{\hfiber{f}b}$ is equivalent to $P(t)\jdeq \unit$ for each $b:B$, and hence contractible.
Thus, $f$ is surjective.

To show that $\mathsf{surj}(f)\to\mathsf{epi}(f)$,
let $f:A\to B$ be a surjective function and consider a set $C$ and two functions
$g,h:B\to C$ with the property that $g\circ f\sim h\circ f$. Since $f$ 
is assumed to be surjective,
we have an equivalence $B\simeq\mathsf{im}(f)$. We have the following equivalences
\begin{align*}
\prd{b:B} g(b)= h(b) 
& \simeq \prd{w:\mathsf{im}(f)} g(\pi_1 w)= h(\pi_1(w))\\
& \simeq \prd{b:B}{a:A}{p:f(a)= b} g(b)= h(b)\\
& \simeq \prd{a:A} g(f(a))= h(f(a)).
\end{align*}
By assumption, there is an element of the latter type.
\end{proof}
The proof that epis are surjective in~\cite{Mines/R/R:1988} uses the power set operation. 
This proof can be made predicative by using a large power set and typical ambiguity.
A predicative proof for setoids was given by Wilander~\cite{Wilander2010}. 
The proof above is similar, but avoids setoids by using the pushout and the
univalence axiom. 
% \begin{rem}
% The above theorem is not true when we replace $\set$ by $\type$
% (replacing it also in the definition of $\mathsf{epi}$ and $\mathsf{epi}'$). 
% However, we do
% get the implications $\textit{ii.}\Rightarrow\textit{iii.}\Rightarrow
% \textit{iv.}$
% \end{rem}

\begin{lem}\label{lem:images_are_coequalizers}
Surjective functions between sets are regular epimorphisms.
\end{lem}

\begin{proof}
Note that it suffices to show that for any function $f:A\to B$, the diagram
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {\sm{x,y:A} f(x)= f(y) & A & \mathsf{im}(f) \\};
\draw[ar] ([yshift=.5ex]m-1-1.east) -- node[above] {$\pi_1$} ([yshift=.5ex]m-1-2.west);
\draw[ar] ([yshift=-.5ex]m-1-1.east) -- node[below] {$\pi_2$} ([yshift=-.5ex]m-1-2.west);
\draw[ar] (m-1-2) -- node[above] {$\tilde{f}$} (m-1-3);
\end{tikzpicture}
\end{equation*}
is a coequalizer diagram.

The first thing we have to verify is that there is a homotopy 
$H:\tilde{f}\circ\pi_1\sim\tilde{f}\circ\pi_2$. Let $\pairr{x,y,p}$ be an element
of $\sm{x,y:A} f(x)= f(y)$. 
Then we have $\tilde{f}(\pi_1(\pairr{x,y,p}))= \pairr{f(x),u}$, 
where $u$ belongs to the contractible type $\|\hfiber{f}{f(x)}\|$. 
Similarly, we have a path 
$\tilde{f}(\pi_2(\pairr{x,y,p}))= \pairr{f(y),v}$,
where $v$ belongs to the contractible type $\|\hfiber{f}{f(y)}\|$.
Since we have $p:f(x)= f(y)$ and since
$\|\hfiber{f}{f(y)}\|$ is contractible, 
it follows that we get a path from $\tilde{f}(\pi_1(\pairr{x,y,p}))$ to
$\tilde{f}(\pi_2(\pairr{x,y,p}))$, which gives us our homotopy.

Now suppose that $g:A\to X$ is a function for which there is a homotopy 
$K:g\circ\pi_1\sim g\circ\pi_2$. We have to show that the space
\begin{equation*}
\sm{h:\mathsf{im}(f)\to X}{L:h\circ\tilde{f}\sim g} h\circ H\sim K
\end{equation*}
is contractible. We will apply unique choice to define a 
function from $\mathsf{im}(f)$ to $X$. Let $R',R:\mathsf{im}(f)\to
X\to\type$ be the relations defined by 
\begin{align*}
R'(w,x) & \defeq\prd{a:A} (\tilde{f}(a)= w)\to (g(a)= x)\\
R(w,x) & \defeq \|R'(w,x)\|.
\end{align*}
Then $\mathsf{atMostOne}(R(w))$ is inhabited for every $w:\mathsf{im}(f)$. 
To see this, note that the type $\mathsf{atMostOne}(R(w))$ is a
proposition. Therefore, there is an equivalence
\begin{equation*}
\big(\prd{w:\mathsf{im}(f)} \mathsf{atMostOne}(R(w))\big)
\simeq\prd{a:A} \mathsf{atMostOne}(R(\tilde{f}(a))).
\end{equation*}
We can simplify this even further to
\begin{equation*}
\prd{a:A} \mathsf{atMostOne}(R^\prime(\tilde{f}(a))).
\end{equation*}
This follows from the assumption that $g(a)= g(a^\prime)$ 
whenever $f(a)= f(a^\prime)$. Let $a:A$, $x,x^\prime:X$,
$u:R^\prime(\tilde{f}(a),x)$ and $u^\prime:R^\prime(\tilde{f}(a),x^\prime)$. 
Then there are the paths $u(a,\refl{\tilde{f}(a)}):g(a)=
x$ and $u^\prime(a,\refl{\tilde{f}(a)}):g(a)= x^\prime$, 
showing that $x= x^\prime$. 

Also, $\|\sm{x:X} R(w,x)\|$ is inhabited for every $w:\mathsf{im}(f)$. Indeed, the space
\begin{equation*}
\prd{w:\mathsf{im}(f)} \big\| \sm{x:X} R(w,x)\big\|
\end{equation*}
is equivalent to the space
\begin{equation*}
\prd{a:A} \big\| \sm{x:X} R(\tilde{f}(a),x)\big\|.
\end{equation*}
The space $\prd{a:A}\sm{x:X} R^\prime(\tilde{f}(a),x)$ is inhabited by
\begin{equation*}
  \lam{a} \pairr{g(a),\lam{a^\prime}{p} K(\pairr{a^\prime,a,p^{-1}})}
\end{equation*}
This shows that the hypotheses of the principle of unique choice are satisfied, so we get an element of
\begin{equation*}
\sm{h:\mathsf{im}(f)\to X}\prd{w:\mathsf{im}(f)} R(w,h(w)).
\end{equation*}
An immediate consequence of the way we constructed our function $h:\mathsf{im}(f)\to X$ is that $h\circ\tilde{f}\sim g$. The result follows
now from the observation that the space
\begin{equation*}
\sm{h^\prime:\mathsf{im}(f)\to X} h^\prime\circ\tilde{f}\sim h\circ\tilde{f}
\end{equation*}
is contractible because $\tilde{f}$ is an epimorphism. 
\end{proof}

\begin{lem}\label{lem:pb_of_coeq_is_coeq}
Pullbacks of surjective functions are surjective. Consequently,
pullbacks of regular epis are regular epis.
\end{lem}

\begin{proof}
Consider a pullback diagram
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {A & B \\ C & D \\};
\draw[ar] (m-1-1) -- (m-1-2);
\draw[ar] (m-1-2) -- node[right] {$g$} (m-2-2);
\draw[ar] (m-1-1) -- node[left]  {$f$} (m-2-1);
\draw[ar] (m-2-1) -- node[below] {$h$} (m-2-2);
\end{tikzpicture}
\end{equation*}
and assume that $g$ is surjective. Applying the pasting lemma of pullbacks
with the morphism $c:\mathsf{unit}\to C$, we obtain an
equivalence $\hfiber{f}c\simeq\hfiber{g}{h(c)}$ for any
$c:C$. This equivalence gives that $f$ is surjective.
\end{proof}

\begin{thm}\label{thm:set_regular}
The category $\set$ is regular.
\end{thm}

\begin{proof}
$\set$ has all limits, so it is finitely complete. 
\autoref{lem:images_are_coequalizers} gives
that the kernel pair of each function has a coequalizer.
\autoref{lem:pb_of_coeq_is_coeq} shows that
regular epis are stable under pullback.
\end{proof}


\subsection{Quotients}\label{subsec:quotients}
Now that we know that $\set$ is regular, to show that $\set$ is exact, we need to show that every
equivalence relation is effective. In other words, given an equivalence
relation $R:A\to A\to\prop$, there is a coequalizer $c_R$ of the pair
$\pi_1,\pi_2:\sm{x,y:A} R(x,y)\to A$ and, moreover, the $\pi_1$ and $\pi_2$
for the kernel pair of $c_R$.

We have already seen, in \autoref{sec:set-quotients}, two general ways to construct the quotient of a set by an equivalence relation $R:A\to A\to\prop$.
The first can be described as the set-coequalizer of the two projections
\[\pi_1,\pi_2:\sm{x,y:A} R(x,y)\to A.\]
The important property of such a quotient is the following.

\begin{defn}
A relation $R:A\to A\to\prop$ is said to be \emph{effective} if the square
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {\sm{x,y:A} R (x,y) & A \\ A & A/R \\};
\draw[ar] (m-1-1) -- node[above] {$\pi_1$} (m-1-2);
\draw[ar] (m-1-2) -- node[right] {$c_{R }$} (m-2-2);
\draw[ar] (m-1-1) -- node[left]  {$\pi_2$} (m-2-1);
\draw[ar] (m-2-1) -- node[below] {$c_R $} (m-2-2);
\end{tikzpicture}
\end{equation*}
is a pullback. 
\end{defn}

\begin{lem}\label{lem:sets_exact}
Suppose $\pairr{A,R}$ is an equivalence relation. Then there is an equivalence
\begin{equation*}
(c_R(x)= c_R(y))\simeq R(x,y)
\end{equation*}
for any $x,y:A$. In other words, equivalence relations are effective.
\end{lem}

\begin{proof}
We begin by extending $R$ to a relation $\tilde{R}:A/R\to A/R\to\prop$. After
the construction of $\tilde{R}$ we will show that $\tilde{R}$ is equivalent
to the identity type on $A/R$. We define $\tilde{R}$ by double induction on
$A/R$ (note that $\prop$ is a set by univalence for propositions). We
define $\tilde{R}(c_R(x),c_R(y)) \defeq R(x,y)$. For $r:R(x,x')$ and $s:R(y,y')$,
the transitivity and symmetry 
of $R$ gives an equivalence from $R(x,y)$ to $R(x',y')$. This completes the
definition of $\tilde{R}$. To finish the proof of the proposition, we need
to show that $\tilde{R}(w,w')\simeq w= w'$ for every $w,w':A/R$. We can
do this by showing that the type $\sm{w':A/R} \tilde{R}(w,w')$ is contractible for
each $w:A/R$. We do this by induction. Let $x:A$. We have the element
$\pair{c_R(x),\rho(x)}:\sm{w':A/R} \tilde{R}(c_R(x),w')$, where $\rho$ is
the reflexivity proof of $R$, hence we only
have to show that
\begin{equation*}
\prd{w':A/R}{r:\tilde{R}(c_R(x),w')} \pairr{w',r}=\pairr{c_R(x),\rho(x)},
\end{equation*}
which we do by induction on $w'$. Let $y:A$ and let $r:R(x,y)$. Then we have
the path $p_R(r)^{-1}:c_R(y)= c_R(x)$. We automatically get a path from
$p_R(r)^{-1}\cdot r=\rho(x)$, finishing the proof.
\end{proof}

The second construction of quotients, which uses impredicativity of mere propositions, was as the set of equivalence classes of $R$ (a subset of its power set):
\[ A\sslash R \defeq \setof{ P:A\to\prop | P \text{ is an equivalence class of } R} \]
Note that if we regard $R$ as a function from $A$ to $A\to \prop$, then $A\sslash R$ is equivalent to $\im(R)$, as constructed in \autoref{sec:image}.
Now in \ref{lem:images_are_coequalizers} we have shown that images are
coequalizers. In particular, we immediately get the coequalizer diagram
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {\sm{x,y:A} R (x)= R (y) & A & A\sslash  R.  \\};
\draw[ar] ([yshift=.5ex]m-1-1.east) -- node[above] {$\pi_1$} ([yshift=.5ex]m-1-2.west);
\draw[ar] ([yshift=-.5ex]m-1-1.east) -- node[below] {$\pi_2$} ([yshift=-.5ex]m-1-2.west);
\draw[ar] (m-1-2) -- (m-1-3);
\end{tikzpicture}
\end{equation*}
We can use this to give an alternative proof that any equivalence relation is effective and that the two definitions of quotients agree.

\begin{thm}\label{prop:kernels_are_effective}
For any function $f:A\to B$ between any two sets, 
the relation $\ker(f):A\to A\to\type$ given by 
$\ker(f,x,y)\defeq f(x)= f(y)$ is effective. 
\end{thm}

\begin{proof}
We will use that $\im(f)$ is the coequalizer of $\pi_1,\pi_2:
\sm{x,y:A} f(x)= f(y)\to A$; 
%we get this equivalence from proposition~\ref{prop:images_are_coequalizers}
. Note that the canonical kernel pair of the function 
$c_f\defeq\lam{a} \pairr{f(a),\tau_1(\pairr{a,\refl{f(a)}})}$ consists
of the two projections
\begin{equation*}
\pi_1,\pi_2:\big(\sm{x,y:A} c_f(x)= c_f(y)\big)\to A.
\end{equation*}
For any $x,y:A$, we have equivalences
\begin{align*}
c_f(x)= c_f(y) & \simeq \sm{p:f(x)= f(y)} p\cdot\tau_1(\pairr{x,\refl{f(x)}})
=\tau_1(\pairr{y,\refl{f(x)}})\\ & \simeq f(x)= f(y),
\end{align*}
where the last equivalence holds because 
$\|\hfiber{f}b\|$ is a proposition for any $b:B$. 
Therefore, we get that
\begin{equation*}
\sm{x,y:A} c_f(x)= c_f(y)\simeq\sm{x,y:A} f(x)= f(y)
\end{equation*}
and hence we may conclude that $\ker f$ is an effective relation 
for any function $f$.
\end{proof}

\begin{thm}
Equivalence relations are effective and there is an equivalence $A/R \simeq A\sslash  R $. 
\end{thm}

\begin{proof}
We need to analyze the coequalizer diagram
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {\sm{x,y:A} R (x)= R (y) & A & A\sslash  R. \\};
\draw[ar] ([yshift=.5ex]m-1-1.east) -- node[above] {$\pi_1$} ([yshift=.5ex]m-1-2.west);
\draw[ar] ([yshift=-.5ex]m-1-1.east) -- node[below] {$\pi_2$} ([yshift=-.5ex]m-1-2.west);
\draw[ar] (m-1-2) -- (m-1-3);
\end{tikzpicture}
\end{equation*}
By the univalence axiom, the space $R (x)= R (y)$ is equivalent to the space of homotopies from $R (x)$ to $R (y)$, which is
equivalent to $\prd{z:A} R (x,z)\simeq R (y,z)$. Since $R $ is an equivalence relation, the latter space is equivalent to $R (x,y)$. To
summarize, we get that $(R (x)= R (y))\simeq R (x,y)$, so $R $ is effective since it is equivalent to an effective relation. Also,
the diagram
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {\sm{x,y:A} R (x,y) & A & A\sslash  R. \\};
\draw[ar] ([yshift=.5ex]m-1-1.east) -- node[above] {$\pi_1$} ([yshift=.5ex]m-1-2.west);
\draw[ar] ([yshift=-.5ex]m-1-1.east) -- node[below] {$\pi_2$} ([yshift=-.5ex]m-1-2.west);
\draw[ar] (m-1-2) -- (m-1-3);
\end{tikzpicture}
\end{equation*}
is a coequalizer diagram. Since coequalizers are unique up to equivalence, it follows that $A/R \simeq A\sslash  R $.
\end{proof}

%\subsection{Predicativity}\label{sec:resizing}
%One may wonder about the predicative interpretation of the quotient constructions above.
%One could argue that the HIT construction is predicative by considering the interpretation of this
%quotient in the setoid model~\cite{Altenkirch1999,coquand2012constructive}. 
%In this model the quotient does not raise the universe level. 
%A similar observation holds for constructions that can be carried out in the groupoid 
%model~\cite{hofmann1998groupoid}. These observations should suffice for the set-level higher inductive 
%types we use in the present paper.
%
%Voevodsky~\cite{Universe-poly} has proposed to allow some impredicativity by adding the following resizing rule:
%\[\text{if } a:\UU_n \text{ and } p:\isprop(a), \text{ then } \mathsf{rr}(a,p): \UU_0,\]
%where $\UU_n$ is any universe and $\UU_0$ is the lowest universe.
%Moreover, when lifted to $\UU_n$, $\mathsf{rr}(a,p)= a$.
%Hence, $\mathsf{rr}$ is an equivalence between $\prop_n$ and $\prop_0$. 
%Here we assume that $\UU_0$ is a subuniverse of $\UU_n$. 
%Another axiom resizes each $\prop_n$ to the lowest universe.
%
%The following replacement axiom is derivable from the resizing axiom; see~\cite{Universe-poly}.
%\note{This doesn't require resizing, only quotients.  HITs work as well.}
%\begin{lem}\label{lem:replacement}
%  Let $\UU$ be a universe and $X:\UU$.
%  If $f:X\twoheadrightarrow Y$ is a surjection and $Y$ is a set, then there exists a $Z:\UU$ which is equivalent to $Y$.
%\end{lem}
%\begin{proof}
%Define $Z\defeq X\sslash \ker f$ using the type of equivalence classes; see~\ref{def:VVquotient}. 
%Then $Z:\UU$, since $\prop_\UU$ is in the lowest universe. Finally, we observe that $Z\defeq X/\ker f\simeq\im f\simeq Y$.
%\end{proof}
%
%%
% I have commented this section out, because it doesn't say anything -- SA
%%

%%
% I have commented the following section out because it doesn't belong in a chapter on Sets -- and doesn't fit anywhere else.
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\subsection{The object classifier}\label{subsec:object-classification}
%In topos theory we have a small subobject classifier classifying the monomorphisms.
%In HoTT without resizing rules, $\prop$ is large. It is a reflective subuniverse see \autoref{subsec:reflective-subuniverses}.
%In higher topos theory one considers not only subobject classifiers, but also \emph{object classifiers} 
%which classify more general classes of maps.
%In this section we will establish the existence of an internal analogue of such object classifiers, 
%they will always sit a higher universe. Moreover, we will find an $n$-object classifier for
%every $n:\mathbb{N}_{\geq-2}$, where the $n$-object classifier will classify the
%functions with $n$-truncated homotopy fibers. 
%
%In addition to the size issue of the object classifers, we will see that the
%$n$-object classifier will generally not be of (homotopy) level $n$, but of level
%$n+1$. This observation should be regarded in contrast to the theory of 
%predicative toposes, where a universal small
%map is required to exist. Such a universal small map is suggested to be a map
%between sets, 
%but it seems that within homotopy type theory we cannot expect
%such a map to exist. The main reason is that the universal small map of sets
%will in general be a map of groupoids; a universal small map of groupoids will
%in general be a map of $2$-groupoids, etc.
%
%\begin{thm}\label{thm:nobject_classifier_appetizer}
%For any type $B$ there is an equivalence
%\begin{equation*}
%\chi:\big(\sm{A:\type} A\to B\big)\simeq B\to\type.
%\end{equation*}
%Likewise, there is an equivalence
%\begin{equation*}
%\chi_n:\big(\sm{A:\type}{f:A\to B} \mathsf{isTrunc}(n,f)\big)\simeq B\to \typele{n}
%\end{equation*}
%for every $n:\mathbb{N}_{\geq-2}$. Here $\mathsf{isTrunc}(n,f)$ denotes that all fibers of $f$ are $n$-truncated
%\end{thm}
%
%\begin{proof}
%We begin by constructing the first equivalence, i.e.\ we have to construct functions
%\begin{align*}
%\chi & : \big(\sm{A:\type} A\to B\big)\to B\to\type\\
%\psi & : (B\to\type)\to\big(\sm{A:\type} A\to B\big).
%\end{align*}
%The function $\chi$ is defined by $\chi(f,b)\defeq\hfiber{f}b$. The
%function $\psi$ is defined by $\psi(P)\defeq\pairr{(\sm{b:B} P(b)),\pi_1}$. Now
%we have to verify that $\chi\circ\psi\sim\idfunc{}$ and that $\psi\circ\chi
%\sim\idfunc{}$:
%\begin{enumerate}
%\item Let $P$ be a dependent type over $B$. It is a basic fact that 
%$\hfiber{\pi_1}{b}\simeq P(b)$ and therefore it follows immediately
%that $P\sim\chi(\psi(P))$.
%\item Let $f:A\to B$ be a function. We have to find a path
%\begin{equation*}
%\pairr{(\sm{b:B} \hfiber{f}b),\pi_1}=\pairr{A,f}
%\end{equation*}
%First note that we have the basic equivalence
%$e:\sm{b:B} \hfiber{f}b\simeq A$ with $e(b,a,p)\defeq a$ and $e^{-1}(a)
%\defeq(f(a),a,\refl{f(a)})$. It also follows that
%$e\cdot\pi_1=\pi_1\circ e^{-1}$. From this, we immediately read off
%that $(e\cdot\pi_1)(a)= f(a)$ for each $a:A$. This completes the proof
%of the first of the asserted equivalences.
%\end{enumerate}
%To find the second set of equivalences, note that if we restrict $\chi$ to
%functions with $n$-truncated homotopy fibers we get an $n$-truncated dependent
%type. Likewise, if we restrict $\psi$ to $n$-truncated dependent types we get
%a function with $n$-truncated homotopy fibers.
%\end{proof}
%
%\begin{defn}
%Define
%\begin{equation*}
%\pointed{\type}\defeq\sm{A:\type} A\qquad\text{and}\qquad \pointed{\typele{n}}\defeq
%\sm{A:\typele{n}} A.
%\end{equation*}
%Thus, $\pointed{\type}$ stands for the \emph{pointed types} and $\pointed{\typele{n}}$ stands for
%the pointed $n$-types.
%\end{defn}
%
%The following theorem states that we have an object classifier.
%\begin{thm}\label{thm:nobject_classifier}
%Let $f:A\to B$ be a function. Then the diagram
%\begin{equation*}
%\begin{tikzpicture}
%\matrix (m) [std] {A & \pointed{\type} \\ B & \type \\};
%\draw[ar] (m-1-1) -- node[above] {$\vartheta_f$} (m-1-2);
%\draw[ar] (m-1-2) -- node[right] {$\pi_1$} (m-2-2);
%\draw[ar] (m-1-1) -- node[left]  {$f$} (m-2-1);
%\draw[ar] (m-2-1) -- node[below] {$\chi_f$} (m-2-2);
%\end{tikzpicture}
%\end{equation*}
%is a pullback diagram. Here, the function $\vartheta_f$ is defined by
%\begin{equation*}
%  \lam{a} \pairr{\hfiber{f}{f(a)},\pairr{a,\refl{f(a)}}}.
%\end{equation*}
%A similar statement holds when we replace $\type$ by $\typele{n}$.
%\end{thm}
%\begin{proof}
%Note that we have the equivalences
%\begin{align*}
%A & \simeq \sm{b:B} \hfiber{f}b\\
% & \simeq \sm{b:B}{X:\type}{p:\hfiber{f}b= X} X\\
% & \simeq \sm{b:B}{X:\type}{x:X} \hfiber{f}b= X\\
% & \equiv B\times_{\type}\pointed{\type}.
%\end{align*}
%which gives us a composite equivalence $e:A\simeq B\times_\type\pointed{\type}$. 
%We may display the action of this composite equivalence step by step by
%\begin{align*}
%a & \mapsto \pairr{f(a),\pairr{a,\refl{f(a)}}}\\
% & \mapsto \pairr{f(a),\hfiber{f}{f(a)},\refl{\hfiber{f}{f(a)}},\pairr{a,\refl{f(a)}}}\\
% & \mapsto \pairr{f(a),\hfiber{f}{f(a)},\pairr{a,\refl{f(a)}},\refl{\hfiber{f}{f(a)}}}
%\end{align*}
%Therefore, we get homotopies $f\sim\pi_1\circ e$ and $\vartheta_f\sim \pi_2\circ e$. 
%\end{proof}
%
%\begin{lem}\label{lem:subobject}
%The type $\pointed{\prop}$ is contractible.
%\end{lem}
%\begin{proof}
%Suppose that $\pairr{P,u}$ is an element of $\sm{P:\prop} P$. Then we have $u:P$ and hence there is a term of type $\mathsf{isContr}(P)$. It
%follows that $P\simeq\unit$ and therefore we get from the univalence axiom that there is a path
%$\pairr{P,u}=\pairr{\unit,\mathsf{tt}}$.
%\end{proof}

\subsection{\texorpdfstring{$\set$}{Set} is a \texorpdfstring{$\Pi$}{Î }W-pretopos}
\label{subsec:piw}

The notion of a $\Pi$W-pretopos -- a locally cartesian closed category with finite coproducts, effective equivalence relations, and $W$-types -- is intended as a ``predicative" notion of topos, i.e.\ a category of ``predicative sets", which can serve the purpose for constructive mathematics that the usual category of sets does for classical mathematics.  

Typically, in constructive type theory, one resorts to an external construction of ``setoids" -- an exact completion -- to obtain a category with such closure properties.  In particular, the well-behaved quotients are required for many constructions in mathematics that usually involve (non-constructive) power sets.  It is noteworthy that HoTT  provides these constructions \emph{internally} (via HITs), without external considerations.  This represents a powerful advantage of our approach, as we shall see in subsequent examples.

\begin{thm} The category $\set$ is a $\Pi$W-pretopos.
\end{thm}
\begin{proof}
We have an initial object $0$ and finite, disjoint sums $A+B$.  These are stable under pullback, simply because pullback has a right adjoint.  Indeed, $\set$ is locally cartesian closed, since for any map $f:A\to B$ between sets, the ``fibrant replacement" $\sm{a:A}f(a)=b$ is equivalent to $A$ (over $B$), and we have $\prod$-types for the replacement.
We've just shown that $\set$ is regular (\autoref{thm:set_regular}) and quotients are effective (\autoref{lem:sets_exact}). We thus have an LCC pretopos. Finally, since the $n$-types are closed under W-types
(\autoref{sec:w-types}), $\set$ is a $\Pi$W-pretopos. 
\end{proof}

One naturally wonders what, if anything, prevents $\set$ from being a topos? In addition to the structure already mentioned, a topos has a small subobject classifier, classifying (equivalence classes of) monomorphisms.  (In fact, in the presence of a subobject classifier, things become somewhat simpler: one merely needs cartesian closure in order to get colimits).  In HoTT, the type $\prop$ does classify monos, but in general it is as large as the universe $U$ over which it is formed by the definition $\prop \defeq \sm{X:U}\isprop(X)$. It is a set, i.e.\ a $0$-type, but it is not an object of $U$.

If we had some suitable ``resizing rules", allowing us to replace the large type $\prop$ with a small type $\Omega:U$, we would thereby obtain the usual notion of a subobject classifier. But without such resizing rules, we do not have a topos of sets, but only a ``predicative topos", i.e.\ a $\Pi$W-pretopos.  Another condition sufficient for making $\set$ into a topos is the law of excluded middle, in the form we have called LEM; for then we have $\prop = \bool$, which \emph{is} small.
A sufficient condition for LEM is AC, the axiom of choice, which is of course often assumed as an axiom of classical set theory. We next verify that this implication does indeed hold in our setting.



\subsection{All surjectives split implies decidability of propositions}\label{sec:surj-split}
In this subsection we derive that if all surjective functions between sets have
a section, then for all propositions $A$ we can decide whether $A$ or $\neg A$
holds. This is an adaptation of an old, famous theorem by
Diaconescu and Bishop to homotopy type theory.

Recall the notion of \emph{suspension} from \autoref{sec:suspension}.
In the case where $A$ is a proposition, it turns out that the
suspension $\susp(A)$ is equivalent to the quotient $\mathsf{bool}/R$,
where $R$ is the equivalence relation we get by setting
$R(\mathsf{true},\mathsf{false})\defeq A$. This shall become clear in the proofs
below.

\begin{lem}\label{prop:trunc_of_prop_is_set}
The suspension of a proposition is a set and the path space 
$0=1$ in $\susp(A)$ is equivalent to $A$, for any proposition $A$. 
\end{lem}

\begin{proof}
Let $A$ be a proposition. Using the univalence axiom, we will define a 
dependent type $P:\susp(A)\to\susp(A)\to\type$ with the 
property that $P(x,y)$ is a proposition for each $x,y:\susp(A)$ 
and which turns out to be equivalent to the dependent type 
$\mathsf{Id}_{\susp(A)}$.

We make the following definitions:
\begin{align*}
P(0,0) & \equiv \unit & P(1,0) & \equiv A\\
P(0,1) & \equiv A & P(1,1) & \equiv \unit.
\end{align*}
To show that this gives a dependent type we need to verify that there 
is an equivalence $P(0,0)\simeq P(0,1)$ and an eqivalence 
$P(1,0)\simeq P(1,1)$ for every $a:A$. Since $A$ is assumed to 
be a proposition, this is indeed the case.

To finish the proof we need to show that $P(x,y)\simeq x=y$ 
for every $x,y:\susp(A)$. We can find such a fiberwise equivalence 
by finding a transformation
\begin{equation*}
\tau(y):\prd{x:\susp(A)} P(x,y)\to x=y
\end{equation*}
which induces an equivalence 
\begin{equation*}
\big(\sm{x:A} P(x,y)\big)\simeq\big(\sm{x:\susp(A)} x=y\big)
\end{equation*}
of total spaces, for every $y:\susp(A)$. The latter type 
is contractible, so it suffices to find the mentioned transformation 
and proof that the total space on the left is contractible. We may do 
the first of these tasks by applying the induction principle for 
$\susp(A)$. We make the definitions
\begin{align*}
  \tau(0,0) & \defeq \lam{t} \refl{0} & \tau(1,0) &\defeq \lam{a} \alpha(a)^{-1}\\
  \tau(0,1) & \defeq \alpha & \tau(1,1) &\defeq \lam{t} \refl{1}.
\end{align*}
To find a path $\alpha(a)\cdot\tau(0,0)=\tau(0,1)$ for $a:A$, 
note that because $A$ is a proposition there are paths
\begin{equation*}
(\alpha(a)\cdot\tau(0,0))(x)=\tau(0,0,x)\bullet\alpha(a)^{-1}
=\alpha(a)^{-1}= \alpha(x)^{-1}. 
\end{equation*}
Thus we get the requested path from function extensionality. Likewise, 
we obtain a path $\tau(0)=\tau(1)$ for every $a:A$, 
which finishes the construction of $\tau$.

The last thing to do to finish the proof is to show that 
$\sm{x:A} P(x,y)$ is contractible for every $y:\susp(A)$. 
Since $\mathsf{isContr}(X)$ is a mere proposition for every type $X$, 
we only need to show that $\sm{x:A} P(x,0)$ and 
$\sm{x:\susp(A)} P(x,1)$ are contractible. 
They are clearly equivalent, so we only verify the contractibility 
of the latter. The obvious candidate for the center of contraction 
is $\pairr{1,\mathsf{tt}}$, thus we need to show that there is a 
function $c$ of type
\begin{equation*}
\prd{x:\susp(A)}{u:P(x,1)} \langle{x,u}\rangle=\langle{1,\mathsf{tt}}\rangle.
\end{equation*}
We do this again by induction on $x$. To define $c(0)$, note that 
for any $a:A$, we have the path $\alpha(a):0= 1$. Since 
$\unit$ is contractible we will automatically get a path 
$\alpha(a)\cdot u=\mathsf{tt}$. The definition of $c(1)$ is obvious. 
Then we get, for $a:A$, a path 
$(\alpha(a)\cdot c(0))(\mathsf{tt})= c(1,\mathsf{tt})$ 
because $\susp(A)$ is contractible when $A$ is contractible. 
This gives us a path $\alpha(a)\cdot c(0)= c(1)$ and finishes 
the proof by induction that $\sm{x:A} P(x,1)$ is contractible.
\end{proof}

\begin{defn}
Suppose $A$ is a type. We define
\begin{equation*}
\mathsf{isDecidable}(A)\equiv  A+\neg A
\end{equation*}
\end{defn}

\begin{thm}[Bishop/Diaconescu]\label{thm:1surj_to_surj_to_pem}
Suppose that all surjections between sets split. Then for all $A:\prop$,
$\mathsf{isDecidable}(A)$. 
\end{thm}

\begin{proof}
Consider the function $\pi:\mathsf{bool}\to\susp(A)$ defined by 
$\pi(\mathsf{true})\equiv 1$ and $\pi(\mathsf{false})\equiv 0$. 
The first thing we will do is show that $\pi$ is surjective, 
i.e.\ that there is a function of type
\begin{equation*}
\prd{x:\susp(A)} \|\hfiber\pi{x}\|.
\end{equation*}
Note that we have the terms 
$\langle{\mathsf{false},\refl{0}}\rangle:\hfiber\pi0$ 
and $\langle{\mathsf{true},\refl{1}}\rangle:\hfiber\pi1$. 
Since $\|\hfiber\pi{x}\|$ is a proposition for each 
$x:\susp(A)$, this gives us the proof by induction of 
the surjectivity of $\pi$.

By proposition~\ref{prop:trunc_of_prop_is_set} the suspension of 
a proposition is always a set, so our assumption gives us a 
section $g:\susp(A)\to\mathsf{bool}$ of $\pi$. 
Since $\mathsf{bool}$ has decidable equality, there is an element of
\begin{equation*}
\mathsf{isDecidable}(g(\pi(\mathsf{true}))= g(\pi(\mathsf{false})))
\end{equation*}
and since $g$ is a section of $\pi$ it follows that there is an element of
\begin{equation*}
\mathsf{isDecidable}(\pi(\mathsf{true})=\pi(\mathsf{false}))
\end{equation*}
Now we see that it is enough to show that 
$\pi(\mathsf{true})= \pi(\mathsf{false})$ is equivalent to $A$. 
This we also obtained in proposition~\ref{prop:trunc_of_prop_is_set}.
\end{proof}

\section{Algebraic set theory}
\note{Steve Awodey}
We should obtain a model of CST following Awodey, Forsell, Warren. 
We may want to use the replacement axiom~\ref{lem:replacement}.
We should consider as classes only those large sets with small diagonal.

The universe is naturally a groupoid, but it may be possible to distort it to be a set.

It seems unlikely that the axiom of collection and the axiom of multiple choice are derivable in HoTT,
simply because none of its axioms seem applicable.  In the constructive set theory CZF~\cite{aczel2001notes}, unlike in classical Zermelo
set theory, the collection axiom is \emph{stronger} than the replacement axiom. 
The replacement axiom \emph{is} derivable from the resizing rules; see section~\ref{sec:resizing}.
In line with Voevodsky's proposal to add resizing rules to homotopy type theory, one could also consider its extension with the
collection axiom.

\subsection{Class of stable maps}
\begin{defn}\label{defn:small_maps}
A class $\smal:\prd{X,Y:\type} (X\to Y)\to\prop$ is \emph{stable} of if it satisfies:
\begin{description}
\item[pullback stability] If we have a pullback diagram
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {X & A \\ Y & B \\};
\draw[ar] (m-1-1) -- (m-1-2);
\draw[ar] (m-1-2) -- node[right] {$f$} (m-2-2);
\draw[ar] (m-1-1) -- node[left]  {$g$} (m-2-1);
\draw[ar] (m-2-1) -- (m-2-2);
\end{tikzpicture}
\end{equation*}
then $\smal(f)\to\smal(g)$.
\item[Descent] If the bottom arrow in the above diagram is surjective, then $\smal(g)\to\smal(f)$. 
\item[Sum] If $\smal(f),\smal(g)$, then $\smal(f+g)$.
\end{description}
A class of stable class of maps is \emph{locally full}~\citep[3.2]{MoerdijkPalmgren2002} if for all $g:X\to Y$ and $f:Y\to Z$ such
that $\smal(f)$: $\smal(g)$ iff $\smal(fg)$.

A class of maps $\smal$ is called a \emph{class of small maps} if it is stable, locally full and for each $X$, 
$\smal_X$ --- the small over maps over $X$ --- forms a $\Pi$W-pretopos; see~\citep[3.3]{MoerdijkPalmgren2002}.
\end{defn}

\begin{lem}
The class of set-fibered maps is a class of small maps.
\end{lem}
\begin{proof}
The class of maps with set-fibers is stable. It even has dependent sums.

We claim that it is locally full: If $g$ has set-fibers, then $fg$ has set-fibers, as sets are
closed under $\Sigma$-types. Conversely, fix $y\in Y$, then $\hfiber g y$ is the pullback
\[\sm {x:\hfiber{fg}{f(y)}} g(x)=y.\]

By the use of the object classifier, \autoref{thm:nobject_classifier}, we see that the type $\smal_X$ is equivalent
to the sets in context $X$. Now, sets in any context form a $\Pi$W-pretopos; see \autoref{subsec:piw}.
\end{proof}

\section{Excluded middle and the axiom of choice}
\label{sec:excl-middle-axiom}

\textbf{TODO:} Discuss excluded middle and choice, state that the appropriate versions are
consistent, so me may assume them. Prove that choice implies excluded middle?
See~\ref{thm:1surj_to_surj_to_pem}

\section{Sets and classes}
\label{sec:sets-classes}

\textbf{TODO:} Discuss the role of universes as classes-of-classes-of-classes, or
alternatively as inaccessible sets.
This could be part of AST(?)

\section{Powersets}
\label{sec:powersets}

\textbf{TODO:} Point out that we get \textbf{powerclasses} when we consider $X \to \prop$, that the
powerset axiom is about powerclasses being sets, that this is equivalent to $\prop$ being
a set, so resizing comes into play.

For a set $X$, we speak of predicates $Y:X\to \prop$ equivalently as \textbf{subsets} of $X$, and sometimes write $x\in Y$ to mean $Y(x)$.
We will also use the set-builder notation for such subsets:
\[ \setof{x:X | P } \defeq \lam{x} P \]
Univalence for \prop, plus function extensionality, implies that such subsets are \emph{extensional} in the usual sense of set theory:
\[ (Y_1 = Y_2) \leftrightarrow \Big(\prd{x:X} (x\in Y_1) \leftrightarrow (x\in Y_2)\Big) \]
Note that both sides of this equivalence are mere propositions.

We define the \textbf{power set} of $X$ to be
\begin{align*}
  \mathcal{P} X &\defeq X\to \prop
\end{align*}
Likewise, we define the subset of merely inhabited subsets in $X$ to be
\begin{align*}
  \mathcal{P}_+ X &\defeq \setof{P:X\to \prop | \brck{(\exists x:X), P(x)}}
\end{align*}
Assuming excluded middle, we have $\mathcal{P}_+ X \cong \setof{P:X\to \prop | P \neq (\lam{x} \bot)}$ and also $\mathcal{P} X \cong \mathcal{P}_+ X + \unit$.

For $Y:\mathcal{P}X$, we write $X\setminus Y \defeq \setof{x:X | x\notin Y}$.
Similarly, we have unions $Y_1 \cup Y_2$, intersections $Y_1 \cap Y_2$, and so on.

\section{The cumulative hierarchy}
\label{sec:cumulative-hierarchy}

Construction of $V$ as a HIT, mimicking Peter Aczel's construction of a type-theoretic
model of CZF.

\marginpar{Is this a valid HIT?}

\begin{defn}
  The \emph{cummulative hierachy $V$} relative to a type universe $\UU$ is the
  higher-inductive type with:
  %
  \begin{enumerate}
  \item \emph{points:} for every $A : \UU$ and $f : A \to V$ there is a point $\vset(A, f)$,
  \item \emph{paths:} for all $A, B : \UU$, $f : A \to V$ and $g : B \to V$ such that
    %
    \begin{equation} \label{eq:V-path}
      (\fall{a:A} \exis{b:B} \id[V]{f(a)}{g(b)}) \land (\fall{b:B} \exis{a:A} \id[V]{f(a)}{g(b)})
    \end{equation}
    %
    there is a path $\id[V]{\vset(A,f)}{\vset(B,g)}$.
  \end{enumerate}
\end{defn}

\noindent
%
In set-theoretic language the element $\vset(A,f)$ could be understood as $\{ f(a) \mid a
\in A \}$, but of course we cannot write this in type theory. The hierarchy $V$ is
bootstraped with the empty map $o : \emptyt \to V$, which corresponds to the empty set.
Then the singleton $\unit \to V$, defined as $\ttt \mapsto \vset(\emptyt, o)$ enters $V$, and so
on. The type $V$ lives in the same universe as the base universe $U$.

\begin{thm} \label{V-is-set}
  The cummulative hierarchy $V$ is $0$-truncated.
\end{thm}

\begin{proof}
  A confusing way of stating the therem is ``$V$ is a set.'' Because~\eqref{eq:V-path} is
  a mere proposition which is obviously reflexive, therefore
  \autoref{thm:h-set-refrel-in-paths-sets} applies.
\end{proof}

The elementhood relation $\in$ is defined on $V$ by
%
\begin{equation*}
  (x \in \vset(A,f)) \defeq \exis{a : A} x = f(a).
\end{equation*}
%
To see that the definition is valid, suppose we have a path $\vset(A, f) = \vset(B, g)$
constructed through~\eqref{eq:V-path}. If $x \in \vset(A,f)$ then there is $a : A$ such
that $x = f(a)$, but by~\eqref{eq:V-path} there is $b : B$ such that $f(a) = g(b)$, hence
$x = g(b)$ and $x \in \vset(B,f)$. The converse is symmetric.

Each $v \in V$ determines its \emph{type of elements} $\setof{ x : V | x \in y }$.

The subset relation $\subseteq$ is defined on $V$ by
%
\begin{equation*}
  (x \subseteq y) \defeq \fall{z : V} z \in x \Leftrightarrow z \in y.
\end{equation*}

A \emph{class} is a mere predicate on~$V$. We say that \emph{$C : V \to \prop$ is a
  $V$-set} if there merely exists $x \in V$ such that
%
\begin{equation*}
  \fall{y : V} C(y) \Leftrightarrow y \in x.
\end{equation*}

\begin{thm}
  The following hold for $(V, {\in})$:
  %
  \begin{enumerate}
  \item \emph{extensionality:}
    %
    \begin{equation*}
      \fall{x, y : V} x \subseteq y \land y \subseteq x \Leftrightarrow x = y.
    \end{equation*}
  \item \emph{replacement:} given any $r : V \to V$ and $x : V$, the class $C(y) \defeq
    \exis{z : V} z \in x \land y = r(z)$ is a $V$-set. If $C(y)$ then there merely exists
    $z : V$ and $a : A$ such that $z = f(a)$ and $y = r(z)$, therefore $y \in w$.
    Conversely, if $y \in w$ then there merely exists $a : A$ such that $y = r(f(a))$, so
    if we take $z \defeq f(a)$ we see that $C(y)$ holds.
  \end{enumerate}
\end{thm}


\begin{proof}
  \mbox{}
  %
  \begin{enumerate}
  \item Extensionality: if $\vset(A,f) \subseteq \vset(B, g)$ then $f(a) \in \vset(B, g)$
    for every $a : A$, therefore for every $a : A$ there merely exists $b : B$ such that
    $f(a) = g(b)$. The assumption $\vset(B, g) \subseteq \vset(A, f)$ gives the other half
    of~\eqref{eq:V-path}, therefore $\vset(A,f) = \vset(B,g)$.

  \item Replacement: the statement ``$C$ is a $V$-set'' is a mere proposition, so we may
    proceed by induction as follows. Supposing $x$ is $\vset(A, f)$, we claim that $w
    \defeq \vset(A, r \circ f)$ is the set we are looking for.

  \end{enumerate}
\end{proof}

\textbf{TODO:} What sort of set theory did we get?


\input{ordcard}

% Local Variables:
% TeX-master: "main"
% End:
