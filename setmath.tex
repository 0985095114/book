\chapter{Set Theory}
\label{cha:set-math}

Our conception of sets as types with simple homotopy structure, cf.\
\autoref{sec:basics-sets}, is at odds with the Zermelo-Frankel sets which form a
cummulative hierarchy. For many purposes the homotopy-theoretic sets are just as good as
the Zermelo-Fraenkel ones, but there are also important differences. We address these in
the present chapter. 

This chapter has three parts. First we show that constructively $\set$ has pleasant categorical structure: it is a
$\Pi W$-pretopos. This part only focuses on the dimension. In the next part we will concentrate on the set/class distinction. Algebraic Set
Theory is the natural framework for doing so. Finally, we show that the theory of ordinals and cardinals from classical set theory can
naturally be developed by considering sets with isomorphisms as equalities. This equality is, of course, precisely the one we obtain from
the univalence axiom.

\section{The image of a function}
FIXME This needs work.


The truncations allow us to define a stable factorization
system\footnote{\url{http://uf-ias-2012.wikispaces.com/file/view/images.pdf/401765624/images.pdf}}.
We will only consider the factorization system given by $(-1)$-truncation.
This defines a stable orthogonal factorization system $(\mathcal{E},
\mathcal{M})$ on $\set$: every map factors as an epimorphism followed by a monomorphism.
We first define these notions:
\begin{defn}
Let $f:A\to B$ be a function between $\set$s. It is \emph{surjective} if
\begin{equation*}
\mathsf{surj}(f)\defeq\prod(b:B),\ \|\hfiber{f}b\|.
\end{equation*}
A monomorphism is a functions with truncated homotopy fibers, i.e.\ if there is a term of type
\begin{equation*}
\mathsf{inj}(f)\defeq\prod(a:A),\ \mathsf{isContr}(\hfiber{f}{f(a)}).
\end{equation*}
\end{defn}

The injective functions are of course the monomorphisms of
$\mathsf{Set}$, which we can also define via a pullback diagram, but we will not do that here.

\begin{defn}
Let $f:A\to B$ be a function between $\set$s. Define
\begin{equation*}
\im(f):=\sum(b:B),\ \|\hfiber{f}b\|
\end{equation*}
We define the functions $\tilde{f}:A\to\im(f)$ and $i_f:\im(f)\to B$ by
\begin{align*}
\tilde{f} & := \lambda a.\pair{f(a),\pi(a,\idfunc{f(a)})}\\
i_f & := \pi_1.
\end{align*}
\end{defn}

\begin{lem}
Then $\tilde{f}$ is epi and $i_f$ is mono.
\end{lem}

\section{Quotients}
\label{sec:quotients}

Both as HIT and impredicatively.\marginpar{BS:Work in progress}

Make sure to state conditions under which a quotient is known to result in a very nice
set. In particular, in \autoref{cha:real-numbers} we need to construct the rationals \Q as
a quotient of $\Z \times \Z$ by a decidable equivalence relation. We need a lemma which
states that such a quotient has decidable equatity (and therefore is a set, for example).


We present two constructions of a quotient by a $\prop$-valued equivalence relation $R$. 
The first one uses as a higher inductive type. We freely add a path $x= y$ whenever $x$ 
and $y$ are related by $R$ and we truncate the quotient to become a set.
Instead of giving the truncated higher inductive definition, we use the coequalizer which was defined above.

\begin{defn}
Let $A$ be a set and let $R:A\to A\to\mathsf{Prop}$ be a binary relation over
$A$, not necessarily an equivalence relation. 
We define $A/R$ to be the coequalizer of the two projections
$\pi_1,\pi_2:\sum(x,y:A),\ R(x,y)\to A$ in $\set$.
\end{defn} 

One can prove that quotients have all the expected properties; see~\ref{RijkeSpitters}.

\subsection{Voevodsky's impredicative quotients}\label{sec:resizing}
The second solution is due to Voevodsky~\cite{pelayo2013preliminary}.
He defines the quotient $A//R $ as the type of equivalence classes of $R$, 
i.e.\ as the image of $R$ in $A\to\mathsf{Prop}$. This gives a direct
construction of quotients, but it requires a resizing rule. We fix an equivalence relation $\pairr{A,R}$.

\begin{defn}
A predicate $P:A\to\mathsf{Prop}$ is said to be an equivalence class with 
respect to $R $ if there is a term of type
\begin{equation*}
\mathsf{isEqClass}(R ,P):=\sum(x:A)\prod(y:A),\ R (x,y)\simeq P(y)
\end{equation*}
\end{defn}

\begin{defn}\label{def:VVquotient}
We define
\begin{equation*}
A/\!\!/ R :=\sum(P:A\to\mathsf{Prop}),\ \|\mathsf{isEqClass}(R ,P)\|.
\end{equation*}
\end{defn}

Using univalence on propositions, the following is an easy consequence of the definition:

\begin{lem}
The type $A/\!\!/ R $ is equivalent to $\im(R)$.
\end{lem}

In proposition~\ref{prop:images_are_coequalizers} we have shown that images are
coequalizers. In particular, we immediately get the coequalizer diagram
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {\sum(x,y:A),\ R (x)= R (y) & A & A/\!\!/ R  \\};
\draw[ar] ([yshift=.5ex]m-1-1.east) -- node[above] {$\pi_1$} ([yshift=.5ex]m-1-2.west);
\draw[ar] ([yshift=-.5ex]m-1-1.east) -- node[below] {$\pi_2$} ([yshift=-.5ex]m-1-2.west);
\draw[ar] (m-1-2) -- (m-1-3);
\end{tikzpicture}
\end{equation*}
We can use this to show that any equivalence relation is effective.

\begin{thm}\label{prop:kernels_are_effective}
For any function $f:A\to B$ between any two sets, 
the relation $\ker(f):A\to A\to\type$ given by 
$\ker(f,x,y):=f(x)= f(y)$ is effective. 
\end{thm}

\begin{proof}
We will use that $\im(f)$ is the coequalizer of $\pi_1,\pi_2:
\sum(x,y:A),\ f(x)= f(y)\to A$; 
%we get this equivalence from proposition~\ref{prop:images_are_coequalizers}
. Note that the canonical kernel pair of the function 
$c_f:=\lambda a.\pairr{f(a),\tau_1(\pairr{a,\idfunc{f(a)}})}$ consists 
of the two projections
\begin{equation*}
\pi_1,\pi_2:\big(\sum(x,y:A),\ c_f(x)= c_f(y)\big)\to A.
\end{equation*}
For any $x,y:A$, we have equivalences
\begin{align*}
c_f(x)= c_f(y) & \simeq \sum(p:f(x)= f(y)),\ p\cdot\tau_1(\pairr{x,\idfunc{f(x)}})
=\tau_1(\pairr{y,\id{f(x)}})\\ & \simeq f(x)= f(y),
\end{align*}
where the last equivalence holds because 
$\|\hfiber{f}b\|$ is a proposition for any $b:B$. 
Therefore, we get that
\begin{equation*}
\sum(x,y:A),\ c_f(x)= c_f(y)\simeq\sum(x,y:A),\ f(x)= f(y)
\end{equation*}
and hence we may conclude that $\ker f$ is an effective relation 
for any function $f$.
\end{proof}

\begin{thm}
Equivalence relations are effective and there is an equivalence $A/R \simeq A/\!\!/ R $. 
\end{thm}

\begin{proof}
We need to analyze the coequalizer diagram
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {\sum(x,y:A),\ R (x)= R (y) & A & A/\!\!/ R  \\};
\draw[ar] ([yshift=.5ex]m-1-1.east) -- node[above] {$\pi_1$} ([yshift=.5ex]m-1-2.west);
\draw[ar] ([yshift=-.5ex]m-1-1.east) -- node[below] {$\pi_2$} ([yshift=-.5ex]m-1-2.west);
\draw[ar] (m-1-2) -- (m-1-3);
\end{tikzpicture}
\end{equation*}
By the univalence axiom, the space $R (x)= R (y)$ is equivalent to the space of homotopies from $R (x)$ to $R (y)$, which is
equivalent to $\prod(z:A),\ R (x,z)\simeq R (y,z)$. Since $R $ is an equivalence relation, the latter space is equivalent to $R (x,y)$. To
summarize, we get that $(R (x)= R (y))\simeq R (x,y)$, so $R $ is effective since it is equivalent to an effective relation. Also,
the diagram
\begin{equation*}
\begin{tikzpicture}
\matrix (m) [std] {\sum(x,y:A),\ R (x,y) & A & A/\!\!/ R  \\};
\draw[ar] ([yshift=.5ex]m-1-1.east) -- node[above] {$\pi_1$} ([yshift=.5ex]m-1-2.west);
\draw[ar] ([yshift=-.5ex]m-1-1.east) -- node[below] {$\pi_2$} ([yshift=-.5ex]m-1-2.west);
\draw[ar] (m-1-2) -- (m-1-3);
\end{tikzpicture}
\end{equation*}
is a coequalizer diagram. Since coequalizers are unique up to equivalence, it follows that $A/R \simeq A/\!\!/ R $.
\end{proof}

One may wonder about the predicative interpretation of the quotient constructions above.
One could argue that the HIT construction is predicative by considering the interpretation of this
quotient in the setoid model~\cite{Altenkirch1999,coquand2012constructive}. 
In this model the quotient does not raise the universe level. 
A similar observation holds for constructions that can be carried out in the groupoid 
model~\cite{hofmann1998groupoid}. These observations should suffice for the set-level higher inductive 
types we use in the present paper.

Voevodsky~\cite{Universe-poly} has proposed to allow some impredicativity by adding the following resizing rule:
\[a:U_n, p:(\mathsf{isprop}\ a)\vdash (\mathsf{rr}\ a\ p): U_0,\]
where $U_n$ is any universe and $U_0$ is the lowest universe.
Moreover, when lifted to $U_n$, $(\mathsf{rr}\ a\ p)= a$.
Hence, $\mathsf{rr}$ is an equivalence between $\prop_n$ and $\prop_0$. 
Here we assume that $U_0$ is a subuniverse of $U_n$. 
Another axiom resizes each $\prop_n$ to the lowest universe.

The following replacement axiom is derivable from the resizing axiom; see~\cite{Universe-poly}.
\begin{lem}
Let $U$ be a universe and $X:U$, if $f:X\twoheadrightarrow Y$ is a surjection, $Y$ is a set then there exists a $Z:U$ which is
equivalent to $Y$.
\end{lem}
\begin{proof}
Define $Z\defeq X/\!\!/\ker f$ using the type of equivalence classes; see~\ref{def:VVquotient}. 
Then $Z:U$, since $\prop_U$ is in the lowest universe. Finally, we observe that $Z\defeq X/\ker f\simeq\im f\simeq Y$.
\end{proof}

\section{Algebraic Set Theory}
% Steve Awodey will write this


\section{Excluded Middle and the Axiom of Choice}
\label{sec:excl-middle-axiom}

\textbf{TODO:} Discuss excluded middle and choice, state that the appropriate versions are
consistent, so me may assume them. Prove that choice implies excluded middle?

\section{Sets and Classes}
\label{sec:sets-classes}

\textbf{TODO:} Discuss the role of universes as classes-of-classes-of-classes, or
alternatively as inaccessible sets.

\section{Powersets}
\label{sec:powersets}

\textbf{TODO:} Point out that we get \textbf{powerclasses} when we consider $X \to \prop$, that the
powerset axiom is about powerclasses being sets, that this is equivalent to $\prop$ being
a set, so resizing comes into play.

For a set $X$, we speak of predicates $Y:X\to \prop$ equivalently as \textbf{subsets} of $X$, and sometimes write $x\in Y$ to mean $Y(x)$.
We will also use the set-builder notation for such subsets:
\[ \setof{x:X | P } \defeq \lambda x.P \]
Univalence for \prop, plus function extensionality, implies that such subsets are \emph{extensional} in the usual sense of set theory:
\[ (Y_1 = Y_2) \leftrightarrow \Big(\prd{x:X} (x\in Y_1) \leftrightarrow (x\in Y_2)\Big) \]
Note that both sides of this equivalence are mere propositions.

We define the \textbf{power set} of $X$ to be
\begin{align*}
  \mathcal{P} X &\defeq X\to \prop
\end{align*}
Likewise, we define the subset of inhabited subsets in $X$ to be
\begin{align*}
  \mathcal{P}_+ X &\defeq \setof{P:X\to \prop | \brck{(\exists x:X), P(x)}}
\end{align*}
Assuming excluded middle, we have $\mathcal{P}_+ X \cong \setof{P:X\to \prop | P \neq (\lambda x.\bot)}$ and also $\mathcal{P} X \cong \mathcal{P}_+ X + \unit$.

For $Y:\mathcal{P}X$, we write $X\setminus Y \defeq \setof{x:X | x\notin Y}$.
Similarly, we have unions $Y_1 \cup Y_2$, intersections $Y_1 \cap Y_2$, and so on.

\section{The cumulative hierarchy}
\label{sec:cumulative-hierarchy}

Construction of $V$ as a HIT, mimicking Peter Aczel's construction of a type-theoretic
model of CZF.


\input{ordcard}

% Local Variables:
% TeX-master: "main"
% End:
