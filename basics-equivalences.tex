\section{Quasi-inverses and (coherent) equivalences}

\begin{defn}
Let $f,g:\prd{x:A}{P(x)}$ be two sections of a dependent type $P:A\to\type$. A
homotopy from $f$ to $g$ is a term of type
\begin{equation*}
f\htpy g\defeq \prd{x:A}{f(x)=g(x)}
\end{equation*}
\end{defn}

Homotopies are always natural with respect to paths:

\begin{lem}
Suppose $H:f\htpy g$ is a homotopy between functions $f,g:A\to B$
 and let $p:x=y$. Then
 \begin{equation*}
 H(y)\ct\ap{f}{p}=\ap{g}{p}\ct H(x).
 \end{equation*}
\end{lem}

\begin{defn}
Consider a function $f:A\to B$. A quasi-inverse of $f$ is a triple 
$(g,\eta,\epsilon)$ consisting of a function $g:B\to A$ and homotopies
$\eta:\idfunc[A]\htpy g\circ f$ and $\epsilon:f\circ g\htpy \idfunc[B]$.
\end{defn}

\begin{rm}
In other words, $f:A\to B$ has a quasi-inverse if there is a term of type
\begin{equation*}
\sm{g:B\to A}((\idfunc[A]\htpy g\circ f)\times(f\circ g\htpy\idfunc[B])).
\end{equation*}
\end{rm}

\begin{defn}
A function $f:A\to B$ is said to be a (coherent) equivalence if there is a
quadruple $(g,\eta,\epsilon,c)$ consisting of $g:B\to A$, $\eta:\idfunc[A]\htpy
g\circ f$, $\epsilon f\circ g\htpy\idfunc[B]$ and
\begin{equation*}
c(a):\epsilon(f(a))\ct f(\eta(a))=\refl{f(a)}
\end{equation*}
for every $a:A$. 
\end{defn}

\begin{rm}
In other words, $f:A\to B$ is an equivalence if there is a term of type
\begin{equation*}
\sm{g:B\to A}{\eta:\idfunc[A]\htpy g\circ f}
{\epsilon:f\circ g\htpy \idfunc[B]}\prd{a:A}(\epsilon(f(a))\ct \ap{f}{\eta(a)}=
\refl{f(a)})
\end{equation*}
\end{rm}

\begin{thm}
A function $f:A\to B$ is an equivalence whenever it has a quasi-inverse.
\end{thm}

\begin{proof}
Suppose that $(g,\eta,\epsilon)$ is a quasi-inverse for $f$. We have to provide
a quadruple $(g',\eta',\epsilon',c)$ witnessing that $f$ is an equivalence. To
define $g'$ and $\eta'$, we can just make the obvious choice by setting $g'
\defeq g$ and $\eta'\defeq \eta$. However, in the definition of $\epsilon'$ we
need to worry about the construction of $c$, so we cannot just follow our nose
and take $\epsilon'$ to be $\epsilon$. Instead, we take
\begin{equation*}
\epsilon'(b) \defeq (\epsilon(b)\ct f(\eta(g(a))^{-1}))\ct \epsilon(f(g(b)))
\end{equation*}
To find $c$, 
\end{proof}
