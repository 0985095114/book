\newcommand{\rclim}{\mathsf{lim}} % HIT constructor for Cauchy reals
\newcommand{\rcrat}{\mathsf{rat}} % Embedding of rationals into Cauchy reals
\newcommand{\Qp}{\Q_{+}}

\chapter{Real Numbers}
\label{cha:real-numbers}

Any foundation of mathematics worthy of its name must eventual address the construction of
real numbers. HoTT can draw experience from constructions of reals in constructive
mathematics, which is not surprising as HoTT \emph{is} a kind of constructive mathematics.

From a classical point of view it is perhaps surprising that there are many kinds of real
numbers. We have encountered the \textbf{homotopical reals} as the universal covering
space of of the circle in \autoref{pi1_S1}. However, there is no algebraic structure on
the homotopical reals, as they are equivalent to the singleton space and so we cannot even
exhibit $0 \neq 1$. What is needed is a set of reals which forms a complete Archimedean
ordered field. There are several notions of completeness, of which we shall have a closer
look at those of Cauchy and Dedekind. Since we are in a constructive setting, the field
structure will involve an apartness relation. And we cannot assume the Axiom of Countable
Choice, which further complicates matters. But let us proceed one step at a time.

\section{The Field of Rational Numbers}
\label{sec:field-rati-numb}

We first construct the integers \Z and the rational numbers \Q, as the reals can then be
seen as a completion of \Q. An expert will point out that \Q could be replaced by any
approximate field, i.e., a subring of \Q in which arbitrarily precise approximate inverses
exist. An example is the ring of dyadic rationals, which are those of the form $n/2^k$.
From an implementation point of view an approximate field is more suitable, but we leave
such finesse for those who care about the digits of~$\pi$.

Starting from the natural numbers \N, we first construct the integers in a familiar
fashion, namely as a quotient
%
\[ \Z \defeq (\N \times \N)/{\sim} \]
%
where
%
\[ (a,b) \sim (c,d) \defeq (a + d = b + c). \]
%
In other words, a pair $(a,b)$ represents the integer $a - b$. The quotient could be
constructed using heavy machinery, as in \autoref{sec:quotients}, but the following lemma
shows that we need not do so.

\begin{lem}\label{lem:quotient-when-canonical-representatives}
  Suppose $\sim$ is an equivalence relation on a set $A$, and there exists an idempotent $r
  : A \to A$ such that, for all $x, y \in A$, $\eqv{(r(x) = r(y))}{(x \sim y)}$. Then the
  type
  %
  \begin{equation*}
    A/{\sim} \defeq \sm{x : A} r(x) = x
  \end{equation*}
  %
  is the set-quotient of~$\sim$ by $A$ in the following sense: there is a map $q : A \to
  A/{\sim}$ such that, for every set $B$, the type $A/{\sim} \to B$ is equivalent to
  %
  \begin{equation}
    \label{eq:quotient-when-canonical}
      \sm{g : A \to B} \prd{x, y : A} (x \sim y) \to g(x) = g(y).
  \end{equation}
\end{lem}

\begin{proof}
  Let $i : \prd{x : A} r(r(x)) = r(x)$ witness idempotence of~$r$.
  The map $q : A \to A/{\sim}$ is defined by $q(x) \defeq (r(x), i(x))$. An equivalence $e$
  from $A/{\sim} \to B$ to~\eqref{eq:quotient-when-canonical} is defined by
  %
  \[ e(f) \defeq (f \circ q, {\ldots}), \]
  %
  where $\ldots$ is the following proof: if $x, y : A$ and $x \sim y$ then by assumption
  $r(x) = r(y)$, hence $(r(x), i(x)) = (r(y), i(y))$ as $A$ is a set, therefore $f(q(x)) =
  f(q(y))$. To see that $e$ is an equivalence, consider the map $e'$ in the opposite
  direction,
  %
  \[ e'(g, p) (x, q) \defeq g(x). \]
  %
  Given any $f : A/{\sim} \to B$,
  %
  \[ e'(e(f))(x, p) \defeq f(q(x)) \defeq f(r(x), i(x)) = f(x, p) \]
  %
  where the last equality holds because $p : r(x) = x$ and so $(x,p) = (r(x), i(x))$
  because $A$ is a set. Similarly we compute
  %
  \[ e(e'(g, p)) \defeq e(g \circ \proj{1}) \defeq (f \circ \proj{1} \circ q, {\ldots}). \]
  %
  Because $B$ is a set we need not worry about the $\ldots$ part, while for the first
  component we have
  %
  \[ f(\proj{1}(q(x))) \defeq f(r(x)) = f(x), \]
  %
  where the last equation holds because $r(x) \sim x$ and $f$ respects $\sim$ by
  assumption.
\end{proof}

The Lemma applies to $\Z$ with the idempotent $r : \N \times \N \to \N \times \N$
defined by
%
\begin{equation*}
  r(a, b) =
  \begin{cases}
    (a - b, 0) & \text{if $a \geq b$,} \\
    (0, b - a) & \text{otherwise.}
  \end{cases}  
\end{equation*}
%
Thus a non-negative integer is canonically represented as $(k, 0)$, while a negative
one by $(0, m)$. It is also clear that equality on \Z is decidable.

The arithmetical operations are induced by those on \N, e.g., if $u, v \in \Z$ are
represented by $(a,b)$ and $(c,d)$, respectively, then $u + v$ is represented by $(a + c,
b + d)$, $-u$ is represented by $(b, a)$, and $u v$ is represented by $(a c + b d, a d + b
c)$. The integers \Z then form the free commutative ring with unit. In fact, using the
results from \autoref{sec:free-algebras} we could have constructed \Z as the free
commutative ring with unit.

The field of rationals \Q is constructed along the same lines as well, namely as the
quotient
%
\[ \Q \defeq (\Z \times \N)/{\approx} \]
%
where
\[ (u,a) \approx (v,b) \defeq (u (b + 1) = v (a + 1)). \]
%
In other words, a pair $(u, a)$ represents the rational number $u / (1 + a)$. There can be
no division by zero because we cunningly added one to the denominator~$a$. Here too we
have a canonical choice of representatives, namely fractions in lowest terms. Thus we may
apply \autoref{lem:quotient-when-canonical-representatives} to obtain a set \Q, which
again has a decidable equality.

We do not bother to write down the arithmetical operations on \Q as we trust our readers
know how to compute with fractions even in the case when one is added to the denominator.
Let us just record the conclusion that there is an entirely unproblematic construction of
the ordered field of rational number \Q, with a decidable equality and decidable order.
The field \Q can also be characterized as the initial one.

\begin{rmk}
  We could have constructed \Z and \Q without appeal to any quotients because both \Z and
  \Q are equivalent to \N as types. The relevant algebraic structure could thus be defined
  directly on the type \N, albeit with an annoying amount of coding of integers and
  rationals as natural numbers.
\end{rmk}

\section{Cauchy Reals}
\label{sec:cauchy-reals}

The Cauchy reals are the completion of \Q with limits of Cauchy sequences. The
construction works well in the presence of the Axiom of Countable Choice, which we do not
have at our disposal. Nevertheless, the higher inductive types come to the rescue and make
the construction possible.

Recall the classic Cauchy condition for a sequence $x : \N \to \Q$, where $\Qp$ is the
type of positive rational numbers:
%
\[ \prd{\epsilon : \Qp} \sm{n : \N} \prd{m, k \geq n} |x_m - x_k| < \epsilon, \]
%
By applying the type-theoretic choice to the condition we get a function $M : \Qp \to \N$,
called the \emph{modulus of convergence}, such that $x_{M(\epsilon)}$ is within $\epsilon$
from the limit. In fact, the composition $x \circ M : \Qp \to \Q$ carries the same
information about the limit as the original Cauchy sequence. For our purposes it is more
convenient to work with such approximation functions than Cauchy sequences.

\begin{defn}\label{defn:cauchy-approximation}
  A \textbf{Cauchy approximation} is a map $x : \Qp \to \Q$ which satisfies
  %
  \begin{equation}
    \label{eq:cauchy-approx}
    \prd{\delta, \epsilon :\Qp} |x_\delta - x_\epsilon| < \delta + \epsilon.
  \end{equation}
  %
  Two Cauchy approximations $x$ and $y$ \textbf{coincide}, written $x \approx y$, when
  %
  \begin{equation}
    \label{eq:cauchy-coincide}
    \prd{\delta, \epsilon:\Qp} |x_\delta - y_\epsilon| < \delta + \epsilon.
  \end{equation}
\end{defn}

At this point we hit a snag. It would be natural to define the Cauchy reals as the
quotient of the type of Cauchy approximations $\mathcal{C}$ by the coincidence
relation~$\approx$. However, we cannot establish completeness of $\mathcal{C}/{\approx}$
because it takes Countable Choice to lift a sequence of reals $x : \N \to
\mathcal{C}/{\approx}$ to a sequence of Cauchy approximations $\N \to \mathcal{C}$.
Without such a lifting we cannot construct a Cauchy approximation for the limit of the
sequences. Every construction of reals whose last step is a quotient suffers from this
deficiency. There are three common ways out of the conundrum:
%
\begin{enumerate}
\item Pretend that the reals are a setoid $(\mathcal{C}, {\approx})$, i.e., the type of
  Cauchy approximations $\mathcal{C}$ with a coincidence relation attached to it by
  administrative decree. A sequence of reals them simply \emph{is} a sequence of Cauchy
  approximations representing them.
\item Give in to temptation and accept the Axiom of Countable Choice. After all, the axiom
  is valid in most models of constructive mathematics based on a computational viewpoint,
  such as realizability models.
\item Declare the Cauchy reals unworthy and construct the Dedekind reals instead. Such a
  verdict is valid in certain contexts, for example in sheaf-theoretic models of
  constructive mathematics. However, as we shall see in the next section, the Dedekind
  reals come with their own set of problems.
\end{enumerate}
%
Since completing the rationals with limits of Cauchy sequences once is insufficient, one
gets the idea that we should add limits of limits as well, and then limits of limits of
limits, and so on (after infinitely many steps, there will be some more). Crucially, we
must quotient by the coincidence relation simulteneously with the inductive construction,
or else we will face again the problem of lifting a sequence of reals to a sequence of
representatives. Higher-inductive types are the perfect solution.

\subsection{Construction of Cauchy Reals}
\label{sec:constr-cauchy-reals}

The construction of Cauchy reals $\RC$ is a \emph{higher inductive-recursive definition},
because it involves a simultaneous definition of $\RC$ and an auxiliary proximity
relation~$\sim$. The idea is as follows: a real number is constructed either as a rational
number, or as a Cauchy approximation $x : \Qp \to \RC$ of previously constructed reals.
But to express~\eqref{eq:cauchy-approx} and~\eqref{eq:cauchy-coincide} for $\RC$ without
referring to yet to be constructed arithmetical operations and the order relation, we must
simultaneously define a relation $x \sim_\epsilon y$ whose intuitive meaning is $|x - y| <
\epsilon$.

\begin{defn}\label{defn:cauchy-reals}
  The \textbf{Cauchy reals \RC} is the higher inductive-recursive type given by the
  following data:
  % 
  \begin{itemize}
  \item \emph{rational points:} 
    for any $q : \Q$ there is a real $\rcrat(q)$.
  \item \emph{limit points}:
    for any $x : \Qp \to \RC$ such that
    %
    \begin{equation}
      \label{eq:RC-cauchy}
      \prd{\delta, \epsilon : \Qp} x_\delta \sim_{\delta + \epsilon} x_\epsilon
    \end{equation}
    %
    there is a point $\rclim(x) : \RC$.
    %
  \item \emph{paths between rational and limit points:}
    if $q : \Q$ and $x : \Qp \to \RC$ satisfies~\eqref{eq:RC-cauchy}, and
    %
    \begin{equation}
      \label{eq:RC-rat-eq-lim}
      \prd{\epsilon : \Qp} \rcrat(q) \sim_{\epsilon} \rclim(x)
    \end{equation}
    %
    then there is a path $\id[\RC]{\rcrat(q)}{\rclim(x)}$.
  \item \emph{paths between limit points:}
    for all $x, y : \Qp \to \RC$ satisfying~\eqref{eq:RC-cauchy} and
    %
    \begin{equation}
      \label{eq:RC-lim-eq-lim}
      \prd{\delta, \epsilon : \Qp} x_\delta \sim_{\delta + \epsilon} y_\epsilon
    \end{equation}
    %
    there is a path $\id[\RC]{\rclim(x)}{\rclim(y)}$.
  \end{itemize}
  % 
  Simultaneously, the relation $u \sim_\epsilon v$ is defined for $u, v : \RC$ and
  $\epsilon : \Qp$ by recursion:
  % 
  \begin{align*}
    \rcrat(q) \sim_\epsilon \rcrat(r)  &\defeq
    |q - r| < \epsilon
    \\
    \rcrat(q) \sim_\epsilon \rclim(y) &\defeq
    \brck{\sm{\delta, \theta : \Qp} \rcrat(q) \sim_{\epsilon - \delta - \theta} y_\delta}
    \\
    \rclim(x) \sim_\epsilon \rcrat(r) &\defeq
    \brck{\sm{\delta, \theta : \Qp} x_\delta \sim_{\epsilon - \delta - \theta} \rcrat(r)}
    \\
    \rclim(x) \sim_\epsilon \rclim(y) &\defeq
    \brck{\sm{\delta, \eta, \theta : \Qp} x_\delta \sim_{\epsilon - \delta - \eta - \theta} y_\eta}.
  \end{align*}  
  %
  (Note: the definition continues with \autoref{lem:RC-well-defined} below.)
\end{defn}

We are not done yet, for we still have to verify that $\sim$ respects the identifications
of~$\RC$. We also remind ourselves of proof-relevance: a real number is represented not
just by a Cauchy approximation $x$, but also a proof $p$ of~\eqref{eq:RC-cauchy}, so we
should have written $\rclim(x,p)$ instead of just $\rclim(x)$; and a similar observation
stands for~\eqref{eq:RC-rat-eq-lim} and~\eqref{eq:RC-lim-eq-lim} and construction of paths.
By the way, the mysterious $\theta$'s appearing in the definition of $\sim$ are there to
give extra ``wiggle room'' which ensures that $\sim$ behaves like $<$ and not like $\leq$.

The definition of $\RC$ is valid if we can show that $u = u'$, $v = v'$ and $u
\sim_\epsilon v$ implies $u' \sim_\epsilon v'$. But this requires yet another auxiliary
lemma, which must thus also be established simultaneously with the inductive construction.

\begin{lem}\label{lem:RC-well-defined}
  Simultaneously with \autoref{defn:cauchy-reals} we have:
  %
  \begin{enumerate}
  \item If $u \sim_\delta v$ and $v \sim_\epsilon w$ then $u \sim_{\delta + \epsilon} w$.
  \item If $u = u'$, $v = v'$ and $u \sim_\epsilon v$ then $u' \sim_\epsilon v'$.
  \end{enumerate}
\end{lem}

\begin{proof}
  \mbox{}
  %
  \begin{enumerate}
  \item The first statement has eight cases, depending on whether $u, v, w$ are rationals
    or limit points. Luckily, many are easy or symmetric, so once you have seen a couple
    you are either convinced or you can do the rest yourself:
    % 
    \begin{itemize}
    \item Suppose $\rcrat(q) \sim_\delta \inr(x) \sim_\epsilon \inr(y)$. There are $\delta',
      \theta', \delta'', \eta'', \theta'' : \Qp$ such that
      % 
      \begin{equation*}
        \rcrat(q)
        \sim_{\delta - \delta' - \theta'}
        x_{\delta'}
        \qquad\text{and}\qquad
        x_{\delta''}
        \sim_{\epsilon - \delta'' - \eta'' - \theta''}
        y_{\eta''}.
      \end{equation*}
      % 
      By taking into account $x_{\delta'} \sim_{\delta' + \delta''} x_{\delta''}$ we
      conclude by the induction hypothesis
      % 
      \begin{equation*}
        \rcrat(q) \sim_{(\delta - \delta' - \theta') + (\delta' + \delta'') + (\epsilon -
          \delta'' - \eta'' - \theta'')} y_{\eta''}
      \end{equation*}
      % 
      which is $\rcrat(q) \sim_{\delta - \eta'' - (\theta' + \theta'')} y_{\eta''}$, as required.
      % 
    \item Suppose $\inr(x) \sim_\delta \inr(y) \sim_\epsilon \inr(z)$. There are $\delta',
      \eta', \theta', \delta'', \eta'', \theta'' : \Qp$ such that
      % 
      \begin{equation*}
        x_{\delta'} \sim_{\delta - \delta' - \eta' - \theta'} y_{\eta'}
        \qquad\text{and}\qquad
        y_{\delta''} \sim_{\epsilon - \delta'' - \eta'' - \theta''} z_{\eta''}.
      \end{equation*}
      % 
      By taking into account $y_{\eta'} \sim_{\eta' + \delta''} y_{\delta''}$ we conclude
      by the induction hypothesis
      % 
      \begin{equation*}
        x_{\delta'} \sim_{(\delta - \delta' - \eta' - \theta') + (\eta' + \delta'') +
          (\epsilon - \delta'' - \eta'' - \theta'')} z_{\eta''},
      \end{equation*}
      %
      which is $x_{\delta'} \sim_{\delta + \epsilon - \delta' - \eta'' - (\theta' +
        \theta'')} z_{\eta''}$, as required.      
    \end{itemize}
  \item The second statement has four cases, one of which is easy and two are symmetric,
    so we are left with two to check (here we use the wiggle room provided by $\theta$):
    %
    \begin{itemize}
    \item Suppose $\rclim(x) = \rclim(y)$ and $\rcrat(q) \sim_\epsilon \rclim(x)$. We
      need to prove that $\rcrat(q) \sim_\epsilon \rclim(y)$. Observe that there are
      $\delta, \theta : \Qp$ such that
      %
      \begin{equation*}
        \rcrat(q) \sim_{\epsilon - \delta - \theta} x_\delta.
      \end{equation*}
      %
      By taking into account $x_\delta \sim_{\delta + \theta/3} y_{\theta/3}$ we conclude
      by the induction hypothesis that      
      %
      \begin{equation*}
        \rcrat(q) \sim_{(\epsilon - \delta - \theta) + (\delta + \theta/3)} y_{\theta/3}
      \end{equation*}
      %
      which is $\rcrat(q) \sim_{\epsilon - \theta/3 + \theta/3} y_{\theta/3}$, as required.
      %
    \item Suppose $\rclim(x) = \rclim(y)$, and $\rclim(y) \sim_\epsilon
      \rclim(z)$. To prove $\rclim(x) \sim_\epsilon \rclim(z)$, observe
      that there are $\delta, \eta, \theta : \Qp$ such that
      %
      \begin{equation*}
        y_\delta \sim_{\epsilon - \delta - \eta - \theta} z_\eta.
      \end{equation*}
      %
      By taking into account $x_{\theta/3} \sim_{\delta + \theta/3} y_\delta$ we conclude
      by induction hypothesis that
      %
      \begin{equation*}
        x_{\theta/3} \sim_{(\delta + \theta/3) + (\epsilon - \delta - \eta - \theta)} z_\eta
      \end{equation*}
      %
      which is $x_{\theta/3} \sim_{\epsilon - \theta/3 - \eta - \theta/3} z_\eta$, as
      required.
    \end{itemize}
  \end{enumerate}
  %
  This completes the construction of Cauchy reals.
\end{proof}

You may be worried that the proof of the lemma was too quick because we hypothesized
existence of all those $\delta$'s, $\epsilon$'s and $\theta$'s, where only mere
existence was granted. All is fine however, because the conclusions of both statements are
mere propositions, too.

We are immediately able to populate $\RC$ with many real numbers. For suppose $q : \N \to
\Q$ is a traditional Cauchy sequence of rational numbers, and let $M : \Qp \to \N$ be its
modulus of convergence. Then $\rcrat \circ q \circ M : \Qp \to \RC$ is a Cauchy
approximation and so $\rclim(\rcrat \circ q \circ m)$ is a real number. Various famous
real numbers $\sqrt{2}$, $\pi$, $e$, \dots are are all limits of such Cauchy sequences of
rationals.

% \begin{thm}\label{RC-is-set}
%   The Cauchy reals are a set.
% \end{thm}

% \begin{proof}
%   We first show that $\left(\prd{\epsilon : \Qp} u \sim_\epsilon v\right) \to \id{u}{v}$
%   for all $u, v : \RC$. We proceed by induction on $u$ and $v$.

%   Since $\rcrat(q) \sim_\epsilon \rcrat(r)$ is defined as $|q - r| < \epsilon$, the case
%   $u = \rcrat{q}$, $v = \rcrat{r}$ is easy.

%   Suppose $\rclim{x} \sim_\epsilon \rclim{y}$ for all $\epsilon : \Qp$. We establish
%   equality of $\rclim(x)$ and $\rclim(y)$ through~\eqref{eq:RC-lim-eq-lim}. Consider any
%   $\delta, \epsilon : \Qp$.

% \end{proof}


\subsection{Arithmetical operations}
\label{sec:arithm-oper}

Defining a function on $\RC$ may be quite laborious, as it leads to a recursion coupled
with an induction which establishes that the recursion respects equality. So let first
prove lemmas that will help with the construction of arithmetical operations.

If $\RC$ were an ordinary inductive type we could prove that every real is of the form
$\rclim{x}$ for some Cauchy approximation~$x$. But this is most definitely \emph{cannot}
do, just like it is not the case that every point in the circle is equal to the base
point, cf.\ \autoref{sec:circle}. [UNFINISHED]

\subsection{Order}
\label{sec:order}

\subsection{Completeness}
\label{sec:completeness}

State the universal property.

Explain how to use Fred Richman's completions. Conclude that complete metric spaces are sets?




\hrulefill

Outline:
\begin{enumerate}
  \item performing the Cauchy construction on the rational once is problematic
  \item performing any construction ending with a quotient is probablematic
  \item But Hits work
  \item we get the minimal cmplete field.
  \item We obtain an hset, becase approx is a Prop
\end{enumerate}

\section{Dedekind Reals}
\label{sec:dedekind-reals}

\begin{enumerate}
\item Recall two-side cuts definition
\item discuss issues of size and impredicativity
\item replace Prop with the sigma-frame (Simpson), using HITs
\item Dedekind complete field, completeness wrt sigma-frames
\item This is a subset of an hSet
\end{enumerate}

\section{Comparison of Cacuhy and Dedekind Reals}
\label{sec:comp-cacuhy-dedek}

Cauchy embeds in Dedekind, we do not expect them to be the same (sheaf model over the
reals) Note, we do not use univalence, hence we have models in sSh(X).

They are the same if we have CAC for Sigma-predicates
Also, $Sigma = 2^N/\sim$.


\section{Reals as a Topological Space}
\label{sec:reals-as-topological}

Heine-Borel... Locales, or formal spaces, would be an alternative. The usual arguments
apply, but we will not go into them.

We obtain constructive mathematics, without countable choice. Little investigated.
See Richman. Note, we are still predicative.

With classical logic, we have Sigma=bool and fan-theorem, Heine-Borel.


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "main"
%%% End: 
