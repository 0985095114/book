\newcommand{\rclim}{\mathsf{lim}} % HIT constructor for Cauchy reals
\newcommand{\rcrat}{\mathsf{rat}} % Embedding of rationals into Cauchy reals
\newcommand{\rceq}{\mathsf{eq}_{\RC}} % HIT path constructor
\newcommand{\CAP}{\mathcal{C}}    % The type of Cauchy approximations
\newcommand{\Qp}{\Q_{+}}

\newcommand{\dcut}{\mathsf{isCut}}  % Dedekind cut


\chapter{Real Numbers}
\label{cha:real-numbers}

Any foundation of mathematics worthy of its name must eventually address the construction
of real numbers as understood by mathematical analysis, namely as a complete archimedean
ordered field. Completeness can be understood either in the sense of Cauchy or Dedekind.
We shall use the familiar Dedekind's construction for our main development, but we we also
present in \autoref{sec:cauchy-reals} an intriguing ``experimental'' construction of
Cauchy reals which uses a form of higher induction-recursion whose status has not been
resolved at present.

It is worth pointing out that the total space of the universal cover of the circle, which
in \autoref{subsec:pi1s1-homotopy-theory} played a role similar to ``the real numbers'' in
classical algebraic topology, is \emph{not} the type of reals we are looking for. That
type is contractible, and thus equivalent to the singleton type, so it cannot be equipped
with a non-trivial algebraic structure.


\section{The Field of Rational Numbers}
\label{sec:field-rati-numb}

We first construct the integers \Z and the rational numbers \Q, as the reals can then be
seen as a completion of \Q. An expert will point out that \Q could be replaced by any
approximate field, i.e., a subring of \Q in which arbitrarily precise approximate inverses
exist. An example is the ring of dyadic rationals, which are those of the form $n/2^k$.
From an implementation point of view an approximate field is more suitable, but we leave
such finesse for those who care about the digits of~$\pi$.

We constructed the integers \Z in \autoref{sec:set-quotients} as a quotient of $\N\times
\N$, and observed that this quotient is generated by an idempotent. In
\autoref{sec:free-algebras} we saw that \Z is the free group on \unit; we could similarly
show that it is the free commutative ring on \emptyt. The field of rationals \Q is
constructed along the same lines as well, namely as the quotient
%
\[ \Q \defeq (\Z \times \N)/{\approx} \]
%
where
\[ (u,a) \approx (v,b) \defeq (u (b + 1) = v (a + 1)). \]
%
In other words, a pair $(u, a)$ represents the rational number $u / (1 + a)$. There can be
no division by zero because we cunningly added one to the denominator~$a$. Here too we
have a canonical choice of representatives, namely fractions in lowest terms. Thus we may
apply \autoref{lem:quotient-when-canonical-representatives} to obtain a set \Q, which
again has a decidable equality.

We do not bother to write down the arithmetical operations on \Q as we trust our readers
know how to compute with fractions even in the case when one is added to the denominator.
Let us just record the conclusion that there is an entirely unproblematic construction of
the ordered field of rational number \Q, with a decidable equality and decidable order.
The field \Q can also be characterized as the initial one.

\section{Dedekind Reals}
\label{sec:dedekind-reals}

Let us first recall the basic idea of Dedekind's construction. We use two-sided Dedekind
cuts, as opposed to an often used one-sided version, because they work classically as well
as constructively. A \emph{Dedekind cut} consists of a pair $(L, U)$ of subsets $L, U
\subseteq \Q$, called the \emph{lower} and \emph{upper cut} respectively, which are:
% 
\begin{enumerate}
\item \emph{inhabited}: there are $q \in L$ and $r \in U$,
\item \emph{rounded:} $q \in L \Leftrightarrow \exists r \in Q .\; q < r \in L$
  and $r \in U \Leftrightarrow \exists r \in Q .\; U \ni q < r$,
\item \emph{disjoint:} $\lnot (q \in L \land q \in U)$, and
\item \emph{located:} $q < r \Rightarrow q \in L \lor r \in U$.
\end{enumerate}
%
Reading the roundedness condition from left to right tells us that cuts are \emph{open},
and from right to left that they are \emph{lower}, respectively \emph{upper}, sets. The
locatedness condition states that there is no large gap between $L$ and $U$. Because cuts
are always open, they never include the ``point in between'', even when it is rational. A
typical Dedekind cut looks like this:
%
\begin{center}
  \begin{tikzpicture}
    \draw[<-),line width=1.5pt] (0,0) -- (3.99,0) node[anchor=south east]{$L\ $};
    \draw[(->,line width=1.5pt] (4.01, 0) node[anchor=south west]{$\ U$} -- (14, 0) ;
  \end{tikzpicture}
\end{center}
%
We might naively translate the informal definition into type theory by saying that a cut
is a pair of maps $L, U : \Q \to \prop$. But we saw in \autoref{subsec:prop-subsets} that
$\prop$ is an ambiguous notation for $\prop_{\UU_i}$ where~$\UU_i$ is a universe. Once we
use a particular $\UU_i$ to define cuts, the type of reals will reside in the next
universe $\UU_{i+1}$, a property of reals two levels higher in $\UU_{i+2}$, a property of
subsets of reals in $\UU_{i+3}$, etc. In principle we should be able to keep track of the
universe levels, especially with the help of a proof assistant, but doing so here would
just burden us with bureaucracy that we prefer to avoid. We shall therefore make a
simplifying assumption that a single type of propositions $\Omega$ is sufficient for all
our purposes.

In fact, the construction of the Dedekind reals is quite resilient to logical
manipulations. There are several ways in which we can make sense of using a single type
$\Omega$:
%
\begin{enumerate}

\item We could identify $\Omega$ with the ambiguous $\prop$ and track all the universes
  that appear in definitions.

\item We could assume impredicativity of mere propositions, cf.\
  \ref{subsec:prop-subsets}, which essentially collapses the $\prop_{\UU_i}$'s to the
  lowest level, which we call $\Omega$.

\item A classical mathematician who is not interested in the intricacies of type-theoretic
  universes or computation may simply assume the law of excluded middle~\eqref{eq:lem} for
  mere propositions so that $\Omega \jdeq \bool$. This not only eradicates questions about
  levels of $\prop$, but also turns everything we do into the standard classical
  construction of real numbers. We discuss this point further in
  \autoref{sec:intuitionistic-vs-classical-analysis}.

\item On the other end of the spectrum one might ask for a minimal requirement that makes
  the constructions work. The condition that a mere predicate be a Dedekind cuts is
  expressible using only conjunctions, disjunctions existential quantifiers over~\Q, which
  is a countable set. Thus we could take $\Omega$ to be the initial \emph{$\sigma$-frame},
  i.e., a lattice with countable joins in which binary meets distribute over countable
  joins. (The initial $\sigma$-frame cannot be the two-point lattice $\bool$ because
  $\bool$ is not closed under countable joins, unless we assume excluded middle.) This
  would lead to a construction of~$\Omega$ as a higher inductive-recursive type, but one
  experiment with higher inductive-recursive types in \autoref{sec:cauchy-reals} is
  enough.
\end{enumerate}

In all of the above cases $\Omega$ is a set.
%
Without further ado, we translate the informal definition into type theory. We use the
logical notation from \autoref{defn:logical-notation}.

\begin{defn}
  A \emph{Dedekind cut} is a pair $(L, U)$ of mere propositions $L : \Q \to \Omega$ and $U
  : \Q \to \Omega$ which is:
  %
  \begin{enumerate}
  \item \emph{inhabited}: $\exis{q : \Q} L(q)$ and $\exis{r : Q} U(r)$,
  \item \emph{rounded:} for all $q, r : \Q$,
    %
    \begin{equation*}
      L(q) \Leftrightarrow \exis{r : \Q} (q < r) \land L(r)
      \quad\text{and}\quad
      U(r) \Leftrightarrow \exis{r : \Q} (q < r) \land L(r),
    \end{equation*}
  \item \emph{disjoint:} $\lnot (L(q) \land U(q))$ for for all $q : \Q$,
  \item \emph{located:} $(q < r) \Rightarrow L(q) \lor U(r)$ for all $q, r : \Q$.
  \end{enumerate}
  %
  We let $\dcut(L, U)$ denote the conjunction of these conditions. The type of
  \emph{Dedekind reals} is
  %
  \begin{equation*}
    \RD \defeq \setof{ (L, U) : (\Q \to \Omega) \times (\Q \to \Omega) | \dcut(L,U)}.
  \end{equation*}
\end{defn}

It is apparent that $\dcut(L, U)$ is a mere proposition, and since $\Q \to \Omega$ is a set
the Dedekind reals form a set too. 
%
The construction of the algebraic and order-theoretic structure of Dedekind reals proceeds
as usual, so we do not dwell on details. Writing $L_x$ and $U_x$ for the lower and upper
cut of a real number $x : \RD$, we define $\leq$ and $<$ by
%
\begin{align*}
  (x \leq y) &\ \defeq \ \fall{q : \Q} L_x(q) \Rightarrow L_y(q), \\
  (x < y)    &\ \defeq \ \exis{q : \Q} U_x(q) \land L_y(q).
\end{align*}
%
The relation $\leq$ is a partial order, and $<$ is transitive and irreflexive. The
trichotomy law
%
\begin{equation*}
  (x < y) \lor (x = y) \lor (y < x)
\end{equation*}
%
is valid if we assume excluded middle, but without it we get the intuitionistic version
%
\begin{equation*}
  (x < y) \Rightarrow (x < z) \lor (z < y).
\end{equation*}
%

\section{Cauchy Reals}
\label{sec:cauchy-reals}

The Cauchy reals are the completion of \Q with limits of Cauchy sequences. The
construction works well in the presence of the Axiom of Countable Choice --- 
that is, the instance of \autoref{eq:ac} where $X=\N$. 
Unfortunately, we do not have this axiom at our disposal for similar reasons as the ones discussed in
\autoref{sec:axiom-choice}. Nevertheless, the higher inductive types come to the rescue and
make
the construction possible.

Recall the classic Cauchy condition for a sequence $x : \N \to \Q$, where $\Qp$ is the
type of positive rational numbers:
%
\[ \prd{\epsilon : \Qp} \sm{n : \N} \prd{m, k \geq n} |x_m - x_k| < \epsilon, \]
%
By applying the type-theoretic choice to the condition we get a function $M : \Qp \to \N$,
called the \emph{modulus of convergence}, such that $x_{M(\epsilon)}$ is within $\epsilon$
from the limit. In fact, the composition $x \circ M : \Qp \to \Q$ carries the same
information about the limit as the original Cauchy sequence. For our purposes it is more
convenient to work with such approximation functions than Cauchy sequences.

\begin{defn}\label{defn:cauchy-approximation}
  A \textbf{Cauchy approximation} is a map $x : \Qp \to \Q$ which satisfies
  %
  \begin{equation}
    \label{eq:cauchy-approx}
    \fall{\delta, \epsilon :\Qp} |x_\delta - x_\epsilon| < \delta + \epsilon.
  \end{equation}
  %
  Two Cauchy approximations $x$ and $y$ \textbf{coincide}, written $x \approx y$, when
  %
  \begin{equation}
    \label{eq:cauchy-coincide}
    \fall{\delta, \epsilon:\Qp} |x_\delta - y_\epsilon| < \delta + \epsilon.
  \end{equation}
\end{defn}

At this point we hit a snag. It would be natural to define the Cauchy reals as the
quotient of the type of Cauchy approximations $\mathcal{C}$ by the coincidence
relation~$\approx$. However, we cannot establish completeness of $\mathcal{C}/{\approx}$
because it takes Countable Choice to lift a sequence of reals $x : \N \to
\mathcal{C}/{\approx}$ to a sequence of Cauchy approximations $\N \to \mathcal{C}$.
Without such a lifting we cannot construct a Cauchy approximation for the limit of the
sequences. Every construction of reals whose last step is a quotient suffers from this
deficiency. There are three common ways out of the conundrum:
%
\begin{enumerate}
\item Pretend that the reals are a setoid $(\mathcal{C}, {\approx})$, i.e., the type of
  Cauchy approximations $\mathcal{C}$ with a coincidence relation attached to it by
  administrative decree. A sequence of reals them simply \emph{is} a sequence of Cauchy
  approximations representing them.
\item Give in to temptation and accept the Axiom of Countable Choice. After all, the axiom
  is valid in most models of constructive mathematics based on a computational viewpoint,
  such as realizability models.
\item Declare the Cauchy reals unworthy and construct the Dedekind reals instead. Such a
  verdict is valid in certain contexts, for example in sheaf-theoretic models of
  constructive mathematics. However, as we shall see in the next section, the Dedekind
  reals come with their own set of problems.
\end{enumerate}
%
Since completing the rationals with limits of Cauchy sequences once is insufficient, one
gets the idea that we should add limits of limits as well, and then limits of limits of
limits, and so on (after infinitely many steps, there will be some more). Crucially, we
must quotient by the coincidence relation simultaneously with the inductive construction,
or else we will face again the problem of lifting a sequence of reals to a sequence of
representatives. Higher-inductive types are the perfect solution.

\subsection{Construction of Cauchy Reals}
\label{sec:constr-cauchy-reals}

The construction of Cauchy reals $\RC$ is a \emph{higher inductive-recursive definition},
because it involves a simultaneous definition of $\RC$ and an auxiliary proximity
relation~$\sim$. The idea is as follows: a real number is constructed either as a rational
number, or as a Cauchy approximation $x : \Qp \to \RC$ of previously constructed reals.
But to express~\eqref{eq:cauchy-approx} and~\eqref{eq:cauchy-coincide} for $\RC$ without
referring to yet to be constructed arithmetical operations and the order relation, we must
simultaneously define a relation $x \sim_\epsilon y$ whose intuitive meaning is $|x - y| <
\epsilon$.

\begin{defn}\label{defn:cauchy-reals}
  The \textbf{Cauchy reals \RC} is the higher inductive-recursive type given by the
  following data:
  % 
  \begin{itemize}
  \item \emph{rational points:} 
    for any $q : \Q$ there is a real $\rcrat(q)$.
  \item \emph{limit points}:
    for any $x : \Qp \to \RC$ such that
    %
    \begin{equation}
      \label{eq:RC-cauchy}
      \fall{\delta, \epsilon : \Qp} x_\delta \sim_{\delta + \epsilon} x_\epsilon
    \end{equation}
    %
    there is a point $\rclim(x) : \RC$. We call $x$ a \emph{Cauchy approximation}.
    %
  \item \emph{paths:}
    for $u, v : \RC$ such that
    %
    \begin{equation}
      \label{eq:RC-path}
      \fall{\epsilon : \Qp} u \sim_\epsilon v
    \end{equation}
    %
    then there is a path $\rceq(u, v) : \id[\RC]{u}{v}$.
  \end{itemize}
  % 
  Simultaneously, the relation $u \sim_\epsilon v$ is defined for $u, v : \RC$ and
  $\epsilon : \Q$ by recursion:
  % 
  \begin{align*}
    \rcrat(q) \sim_\epsilon \rcrat(r)  &\defeq
    -\epsilon < q - r < \epsilon
    \\
    \rcrat(q) \sim_\epsilon \rclim(y) &\defeq
    \exis{\delta, \theta : \Qp} \rcrat(q) \sim_{\epsilon - \delta - \theta} y_\delta
    \\
    \rclim(x) \sim_\epsilon \rcrat(r) &\defeq
    \exis{\delta, \theta : \Qp} x_\delta \sim_{\epsilon - \delta - \theta} \rcrat(r)
    \\
    \rclim(x) \sim_\epsilon \rclim(y) &\defeq
    \exis{\delta, \eta, \theta : \Qp} x_\delta \sim_{\epsilon - \delta - \eta - \theta} y_\eta.
  \end{align*}  
  %
  (Note: the definition continues with \autoref{lem:RC-well-defined} below.)
\end{defn}

We are not done yet, for we still have to verify that $\sim$ respects the identifications
of~$\RC$. We also remind ourselves of proof-relevance: a real number is represented not
just by a Cauchy approximation $x$, but also a proof $p$ of~\eqref{eq:RC-cauchy}, so we
should have written $\rclim(x,p)$ instead of just $\rclim(x)$; and a similar observation
stands for~\eqref{eq:RC-path} and construction of paths. In fact, we shall write just
$\rceq : u = v$ instead of $\rceq(u, v, p) : u = v$. These abuses of notation are
mitigated by the fact that we are omitting mere propositions and information that is
readily guessed. The mysterious $\theta$'s appearing in the definition are there to give
extra ``wiggle room'' which ensures that $\sim$ behaves like $<$ and not like $\leq$.

To complete the construction of $\RC$ we must show that $u = u'$, $v = v'$ and $u
\sim_\epsilon v$ implies $u' \sim_\epsilon v'$. But this requires yet another auxiliary
lemma, which must thus also be established simultaneously with the inductive construction.

\begin{lem}\label{lem:RC-well-defined}
  Simultaneously with \autoref{defn:cauchy-reals} we have:
  %
  \begin{enumerate}
  \item \label{RC-well-defined-i}
    If $u \sim_\delta v$ and $v \sim_\epsilon w$ then $u \sim_{\delta + \epsilon} w$.
  \item \label{RC-well-defined-ii}
    If $u = u'$, $v = v'$ and $u \sim_\epsilon v$ then $u' \sim_\epsilon v'$.
  \end{enumerate}
\end{lem}

\begin{proof}
  \mbox{}
  %
  \begin{enumerate}
  \item The first statement has eight cases, depending on whether $u, v, w$ are rational
    or limit points. Luckily, many are easy or symmetric, so once you have seen a couple
    you are either convinced or you can do the rest yourself:
    % 
    \begin{itemize}
    \item Suppose $\rcrat(q) \sim_\delta \rclim(x) \sim_\epsilon \rclim(y)$. There merely are
      $\delta', \theta', \delta'', \eta'', \theta'' : \Qp$ such that
      % 
      \begin{equation*}
        \rcrat(q)
        \sim_{\delta - \delta' - \theta'}
        x_{\delta'}
        \qquad\text{and}\qquad
        x_{\delta''}
        \sim_{\epsilon - \delta'' - \eta'' - \theta''}
        y_{\eta''}.
      \end{equation*}
      % 
      By taking into account $x_{\delta'} \sim_{\delta' + \delta''} x_{\delta''}$ we
      conclude by the induction hypothesis
      % 
      \begin{equation*}
        \rcrat(q) \sim_{(\delta - \delta' - \theta') + (\delta' + \delta'') + (\epsilon -
          \delta'' - \eta'' - \theta'')} y_{\eta''}
      \end{equation*}
      % 
      which is $\rcrat(q) \sim_{\delta - \eta'' - (\theta' + \theta'')} y_{\eta''}$, as required.
      % 
    \item Suppose $\rclim(x) \sim_\delta \rclim(y) \sim_\epsilon \rclim(z)$. There merely are
      $\delta', \eta', \theta', \delta'', \eta'', \theta'' : \Qp$ such that
      % 
      \begin{equation*}
        x_{\delta'} \sim_{\delta - \delta' - \eta' - \theta'} y_{\eta'}
        \qquad\text{and}\qquad
        y_{\delta''} \sim_{\epsilon - \delta'' - \eta'' - \theta''} z_{\eta''}.
      \end{equation*}
      % 
      By taking into account $y_{\eta'} \sim_{\eta' + \delta''} y_{\delta''}$ we conclude
      by the induction hypothesis
      % 
      \begin{equation*}
        x_{\delta'} \sim_{(\delta - \delta' - \eta' - \theta') + (\eta' + \delta'') +
          (\epsilon - \delta'' - \eta'' - \theta'')} z_{\eta''},
      \end{equation*}
      %
      which is $x_{\delta'} \sim_{\delta + \epsilon - \delta' - \eta'' - (\theta' +
        \theta'')} z_{\eta''}$, as required.      
    \end{itemize}
  \item The second statement has a number of cases, of which we show a representative
    case (here we use the wiggle room provided by $\theta$), and leave others as exercise.
    %
    Suppose $\rceq : \rclim(x) = \rclim(y)$ and $\rcrat(q)
      \sim_\epsilon \rclim(x)$. We need to prove $\rcrat(q) \sim_\epsilon \rclim(y)$.
      By assumption there merely exist $\delta, \theta : \Qp$ such that
      %
      \begin{equation*}
        \rcrat(q) \sim_{\epsilon - \delta - \theta} x_\delta.
      \end{equation*}
      %
      By applying~\eqref{eq:RC-path} with $\theta/2$ as $\epsilon$ we get $\alpha, \beta,
      \gamma : \Qp$ such that
      % 
      \begin{equation*}
        x_\alpha \sim_{\theta/2 - \alpha - \beta - \gamma} y_\beta.
      \end{equation*}
      %
      By taking into account
      %
      \begin{equation*}
        x_\delta \sim_{\delta + \alpha} x_\alpha
      \end{equation*}
      %
      we get, using \autoref{RC-well-defined-i} of induction hypothesis,
      %
      \begin{equation*}
        \rcrat(q)
        \sim_{\epsilon - \delta - \theta + \delta + \alpha + \theta/2 - \alpha - \beta - \gamma}
        y_\beta
      \end{equation*}
      %
      which is $\rcrat(q) \sim_{\epsilon - \beta - (\theta/2 + \gamma)} y_\beta$, therefore
      $\rcrat(q) \sim_\epsilon \rclim(y)$.
  \end{enumerate}
  %
  This completes the construction of Cauchy reals.
\end{proof}

We are immediately able to populate $\RC$ with many real numbers. For suppose $q : \N \to
\Q$ is a traditional Cauchy sequence of rational numbers, and let $M : \Qp \to \N$ be its
modulus of convergence. Then $\rcrat \circ q \circ M : \Qp \to \RC$ is a Cauchy
approximation and so $\rclim(\rcrat \circ q \circ m)$ is a real number. Various famous
real numbers $\sqrt{2}$, $\pi$, $e$, \dots are are all limits of such Cauchy sequences of
rationals.

\begin{thm}
  The Cauchy reals are a set.
\end{thm}

\begin{proof}
  The mere relation $P(u,v) \defeq \fall{\epsilon : \Qp} u \sim_\epsilon v$ is reflexive by
  construction, therefore $\RC$ is a set by \autoref{thm:h-set-refrel-in-paths-sets}.
\end{proof}

We may use the higher-inductive nature of $\RC$ to prove mere properties of reals and
define maps from reals by induction. Explicitly, to prove that a mere property $P$ holds
for all reals, it suffices to:
%
\begin{enumerate}
\item prove $P(\rcrat(q))$ for all $q : \Q$, and
\item prove for all Cauchy approximations $x : \Qp \to \RC$, if $\fall{\epsilon : \Qp}
  P(x_\epsilon)$ then $P(\rclim(x))$.
\end{enumerate}
%
Similarly, to construct a map $f : \RC \to A$ it suffices to:
%
\begin{enumerate}
\item for every $q : \Q$ construct $f(\rcrat(q)) : A$,
\item for every Cauchy approximation $x : \Qp \to \RC$, construct $f(x) : A$,
  assuming that $f(x_\epsilon)$ has already been defined for all $\epsilon : \Qp$,
\item prove $f(u) = f(v)$ for all $u, v : \RC$ satisfying~\eqref{eq:RC-path}.
\end{enumerate}
%
We demonstrate the techinque by proving a series of lemmas that establish the basic
properties of~$\sim$ and show how Lipschitz functions may be extended from~$\Q$ to~$\RC$. 
We use the obvious fact that $\sim_\epsilon$ is a symmetric mere proposition.

The first batch of lemmas explain how to prove properties of Cauchy approximations ``by
induction''. For this purpose, define the type of Cauchy approximations
% 
\begin{equation*}
  \CAP \defeq
  \setof{ x : \Qp \to \RC |
    \fall{\epsilon, \delta : \Qp} x_\delta \sim_{\delta + \epsilon} x_\epsilon
  }.
\end{equation*}

\begin{lem} \label{RC-lim-onto}
  Every real merely is a limit point: $\fall{u : \RC} \exis{x : \CAP} u = \rclim(x)$.
\end{lem}

\begin{proof}
  A rational point $\rcrat(q)$ is equal to $\rclim(\lam{\blank} q)$, while a limit
  point is $\rclim(x)$ is of course equal to itself.
\end{proof}

\begin{lem} \label{RC-lim-factor}
  If $f : \CAP \to A$ respects coincidence of Cauchy approximations,
  %
  \begin{equation*}
    \fall{x, y : \CAP} \rclim(x) = \rclim(y) \Rightarrow f(x) = f(y),
  \end{equation*}
  %
  then it factors uniquely through $\rclim : \CAP \to \RC$.
\end{lem}

\begin{proof}
  We seek $\bar{f} : \RC \to A$ such that $f = \bar{f} \circ \rclim$. Uniqueness of
  $\bar{f}$ is guaranteed by \autoref{RC-lim-onto}. We construct $\bar{f}$ recursively by
  %
  \begin{align*}
    \bar{f}(\rcrat(q)) &\defeq f(\lam{\blank} q), \\
    \bar{f}(\rclim(x)) &\defeq f(x).
  \end{align*}
  %
  To see that $\bar{f}$ is well defined, suppose $\fall{\epsilon : \Qp} u \sim_\epsilon v$
  for $u, v : \RC$. We proceed by induction. If $u$ and $v$ are both rational points, then
  they are equal so $\bar{f}(u) = \bar{f}(v)$. If $u$ is $\rcrat(q)$ and $v = \rclim(x)$
  then $\rclim(\lam{\blank} q) = \rclim(x)$, as can be readily verified, therefore
  $\bar{f}(\rcrat(q)) = f(\lam{\blank} q)) = \bar{f}(\rclim(x)) = \bar{f}(x)$. The
  last case holds by assumption.
\end{proof}

\begin{lem} \label{RC-seq-induction}
  Suppose $P : \CAP \to \prop$ respects coincidence of Cauchy approximations. To show
  $\fall{x : C} P(x)$ it suffices to verify
  %
  \begin{equation*} \label{eq:RC-seq-induction-i}
    \fall{q : \Q} P(\lam{\blank} \rcrat(q))
  \end{equation*}
  %
  and
  %
  \begin{equation} \label{eq:RC-seq-induction-ii}
    \fall{x : C}
    \left(\fall{\delta : \Qp}{y : C} x_\delta = \rclim(y) \Rightarrow P(y) \right)
    \Rightarrow P(x).
  \end{equation}
\end{lem}

\begin{proof}
  Let $Q : \RC \to \prop$ be the factorization of $P$ constructed in
  \autoref{RC-lim-factor}, so that $Q(\rcrat(q)) \jdeq P(\lam{\blank} \rcrat(q))$
  and $Q(\rclim(x)) \jdeq P(x)$. It suffices to show $\fall{u : \RC} Q(u)$, which we do by
  induction. The case $Q(\rcrat(q))$ holds by~\eqref{eq:RC-seq-induction-i}. Consider a
  Cauchy approximation $x : \Qp \to \RC$, and assume $Q(x_\epsilon)$ holds for all
  $\epsilon : \Qp$. We show that $P(x)$ holds using~\eqref{eq:RC-seq-induction-ii}.
  Suppose $\delta : \Qp$, $y : C$ and $x_\delta = \rclim(y)$. By assumption $Q(x_\delta)$
  holds, but then $Q(\rclim(y))$ holds too, which is just $P(y)$.
\end{proof}

The next lemma shows that $\sim$ behaves like a uniformity.

\begin{lem}\label{RC-sim-uniformity-properties}
  \mbox{}
  %
  \begin{enumerate}

  \item \label{RC-sim-diagonal}
    $\sim$ contains the diagonal:
    $u \sim_\epsilon u$ for all $u : \RC$ and $\epsilon : \Qp$,

  \item \label{RC-sim-rounded}
    $\sim$ is \emph{rounded}:
    for all $u, v : \RC$ and $\epsilon : \Qp$
    %
    \begin{equation*}
      \eqv{
        (u \sim_\epsilon v)
      }{
        \exis{\theta : \Qp} u \sim_{\epsilon - \theta} v
      },
    \end{equation*}

  \item \label{RC-sim-lim-rounded}
    For all Cauchy approximations $x : \Qp \to \RC$, $u : \RC$ and $\epsilon : \Qp$,
    %
    \begin{equation} \label{eq:RC-sim-lim-rounded-i}
      \eqv{
        (\rclim(x) \sim_\epsilon u)
      }{
        \exis{\delta, \theta : \Qp} x_\delta \sim_{\epsilon - \delta - \theta} u
      }
    \end{equation}
    %
    and symmetrically
    %
    \begin{equation} \label{eq:RC-sim-lim-rounded-ii}
      \eqv{
        (u \sim_\epsilon \rclim(x))
      }{
        \exis{\delta, \theta : \Qp} u \sim_{\epsilon - \delta - \theta} x_\delta
      }.
    \end{equation}

  \item \label{RC-sim-self}
    $\rclim(x) \sim_{\delta + \epsilon} x_\epsilon$ for all $\delta, \epsilon : \Qp$
    and Cauchy approximations $x : \Qp \to \RC$.

  \end{enumerate}
\end{lem}

\begin{proof}
  \mbox{}
  %
  \begin{enumerate}

  \item 
    It is obvious that $\rcrat(q) \sim_\epsilon \rcrat(q)$. To see that $\rclim(x)
    \sim_\epsilon \rclim(x)$, use the induction hypothesis to establish $x_{\epsilon/4}
    \sim_{\epsilon/4} x_{\epsilon/4}$, whence $\rclim(x) \sim_\epsilon \rclim(x)$ as
    $\epsilon/4 = \epsilon - \epsilon/4 - \epsilon/4 - \epsilon/4$.

  \item We proceed by induction on $u$ and $v$. When $u$ is $\rcrat(q)$ and $v$ is
    $\rcrat(r)$ there is no trouble as $\Q$ is a decidable dense order. If $u$ is
    $\rclim(x)$ and $v$ is $\rcrat(q)$ we find that, using the induction hypothesis for
    $x_\delta$ in the second step,
    %
    \begin{align*}
      (\rclim(x) \sim_\epsilon \rcrat(q))
      &\jdeq
      \exis{\delta, \theta : \Qp} x_\delta \sim_{\epsilon - \delta - \theta} \rcrat(q)
      \\
      &\simeq
      \exis{\delta, \theta : \Qp}{\theta' : \Qp}
        x_\delta \sim_{\epsilon - \delta - \theta - \theta'} \rcrat(q)
      \\
      &\simeq
      \exis{\theta' : \Qp}{\delta, \theta : \Qp}
          x_\delta \sim_{(\epsilon - \theta') - \delta - \theta} \rcrat(q)
      \\
      &\simeq
      \exis{\theta' : \Qp} \rclim(x) \sim_{\epsilon - \theta'} \rcrat(q).
    \end{align*}
    %
    There is another symmetric case, while the last one is similar enough that we leave it
    as an exercise.

  \item It is not hard to see that \eqref{eq:RC-sim-lim-rounded-i} and
    \eqref{eq:RC-sim-lim-rounded-ii}, seen as mere predicates on $x$, respect coincidence
    of Cauchy approximations, therefore \autoref{RC-seq-induction} is applicable. If we
    substitute $\lam{\blank} q$ for $x$ we get true statements by definition
    of~$\sim$. It remains to verify the second condition of~\autoref{RC-seq-induction},
    which we do by induction on $u$. When $u$ is $\rcrat(q)$ the two equivalences hold by
    definition of $\sim$. If $u$ is $\rclim(y)$ then we get
    %
    \begin{align*}
      \rclim(x) \sim_\epsilon \rclim(y) &\jdeq
      \exis{\delta, \eta, \theta' : \Qp}
        x_\delta \sim_{\epsilon - \delta - \eta - \theta'} y_\eta
      \\
      &\simeq
      \exis{\delta, \theta' : \Qp}
        x_\delta \sim_{\epsilon - \delta - \theta'/2} \rclim(y)
      \\
      &\simeq
      \exis{\delta, \theta : \Qp} x_\delta \sim_{\epsilon - \delta - \theta} \rclim(y),
    \end{align*}
    % 
    where we used the ``induction hypothesis'' for $x_\delta$ in the second step. The
    other case is symmetric.

  \item As $x$ is a Cauchy approximation, $x_{\delta/3} \sim_{(\epsilon + \delta) -
      \delta/3 - \delta/3} x_\epsilon$, hence $\rclim(x) \sim_{\epsilon + \delta}
    x_\epsilon$ by \autoref{RC-sim-lim-rounded}.
  \end{enumerate}
\end{proof}

\noindent
We remark that reading \autoref{RC-sim-rounded} from right to left gives
\emph{monotonicity} of $\sim$,
%
\begin{equation*}
  (\delta < \epsilon) \land (u \sim_\delta v) \Rightarrow u \sim_\epsilon v
\end{equation*}
%
and reading it left to right to \emph{openness} of $\sim$,
%
\begin{equation*}
  u \sim_\epsilon v \Rightarrow \exis{\epsilon : \Qp} (\delta < \epsilon) \land u \sim_\delta v.
\end{equation*}

The last two lemmas say that Lipschitz functions extend from $\Q$ to $\RC$. We present
here univariate versions, even though we shall require multivariate ones as well.

\begin{lem} \label{RC-Lipschitz-eq}
  Suppose $f,g : \RC \to \RC$ are Lipschitz maps, in the sense that there is $L : \Qp$
  such that $u \sim_\epsilon v$ implies $f(u) \sim_{L \epsilon} f(v)$ and $g(u) \sim_{L
    \epsilon} g(v)$, for all $u, v : \RC$ and $\epsilon : \Qp$. If $f(\rcrat(q)) =
  g(\rcrat(q))$ for all $q : \Qp$ then $f = g$.
\end{lem}

\begin{proof}
  We show that $f(u) = g(u)$ for all $u : \RC$ by induction on $u$. When $u$ is
  $\rcrat(q)$ this holds by assumption. When $u$ is $\rclim(x)$ we prove $f(\rclim(x)) =
  g(\rclim(x))$ using~\eqref{eq:RC-path}. For any $\epsilon : \Qp$, using
  \autoref{RC-sim-self} of \autoref{RC-sim-uniformity-properties},
  %
  \begin{equation*}
    \rclim(x) \sim_{\epsilon/(2 L)}
    x_{\epsilon/(4 L)} =
    x_{\epsilon/(4 L)} \sim_{\epsilon/(2 L)}
    \rclim(x).
  \end{equation*}
  %
  Now, by the Lipschitz condition and the induction hypothesis
  %
  \begin{equation*}
    f(\rclim(x)) \sim_{\epsilon/2}
    f(x_{\epsilon/4}) =
    g(x_{\epsilon/4}) \sim_{\epsilon/2}
    g(\rclim(x)),
  \end{equation*}
  %
  therefore $f(\rclim(x)) \sim_\epsilon g(\rclim(x))$, as required.
\end{proof}

\begin{lem}\label{RC-extend-Q-Lipschitz}
  Suppose $f : \Q \to \Q$ is a Lipschitz map with a Lipschitz constant $L : \Qp$, so that
  $|f(q) - f(r)| \leq L \cdot |q - r|$ for all $q, r : \Q$. There is a unique $\bar{f} :
  \RC \to \RC$ for which $\bar{f} \circ \rcrat = \rcrat \circ f$ and the Lipschitz
  condition holds: for all $u, v : \RC$ and $\epsilon : \Qp$,
  %
  \begin{equation*}
    (u \sim_\epsilon v) \Rightarrow \bar{f}(u) \sim_{L \epsilon} \bar{f}(v).
  \end{equation*}
\end{lem}

\begin{proof}
  We define the extension $\bar{f}$ by induction, and simultaneously show the Lipschitz
  condition, while uniqueness follows directly from \autoref{RC-Lipschitz-eq}. Define for
  $q : \Q$
  %
  \begin{equation*}
    \bar{f}(\rcrat(q)) \defeq \rcrat(f(q))
  \end{equation*}
  %
  and for a Cauchy approximation $x : \Qp \to \RC$
  % 
  \begin{equation*}
    \bar{f}(\rclim(x)) \defeq \rclim(\lam{\epsilon : \Qp} \bar{f}(x_{\epsilon/L})),
  \end{equation*}
  %
  where $y \defeq \lam{\epsilon : \Qp} \bar{f}(x_{\epsilon/L})$
  satisfies~\eqref{eq:RC-cauchy} because, for all $\delta, \epsilon : \Qp$, from
  $x_{\delta/L} \sim_{(\delta + \epsilon)/L} x_{\epsilon/L}$ we get by induction
  hypothesis $y_\delta \jdeq f(x_{\delta/L}) \sim_{\delta + \epsilon} f(x_{\epsilon/L})
  \jdeq y_\epsilon$.

  It remains to show, for all $u, v : \RC$:
  %
  \begin{itemize}
  \item preservation of equality: if $\fall{\epsilon : \Qp} u \sim_\epsilon v$ then
    $\bar{f}(u) = \bar{f}(v)$, and
  \item the Lipschitz condition: for all $\epsilon : \Qp$ if $u \sim_\epsilon v$ then
    $\bar{f}(u) \sim_{L \epsilon} \bar{f}(v)$.
  \end{itemize}
  %
  We prove both statements simultaneously by induction on $u$ and $v$. There are four
  cases to consider (we omit one symmetric case):
  %
  \begin{enumerate}

  \item When $u$ is $\rcrat(q)$ and $v$ is $\rcrat(r)$, preservation of equality holds because
    $\fall{\epsilon : \Qp} \rcrat(q) \sim \rcrat(r)$ implies $q = r$, and the Lipschitz condition
    reduces to an assumption.

  \item When $u$ is $\rclim(x)$ and $v$ is $\rcrat(q)$ we proceed as follows.
    %
    \begin{itemize}
    \item Preservation of equality: given any $\epsilon : \Qp$, there merely exist $\eta,
      \theta : \Qp$ such that $x_\eta \sim_{\epsilon/L - \eta - \theta} \rcrat(q)$. By
      induction hypothesis $\bar{f}(x_\eta) \sim_{\epsilon - L \eta - L \theta}
      \bar{f}(\rcrat(q))$, therefore $\bar{f}(x) \sim_\epsilon \bar{f}(\rcrat(q))$.

    \item Lipschitz condition:
      %
      supposing $\rclim(x) \sim_\epsilon \rcrat(q)$, there merely exist $\eta, \theta :
      \Qp$ such that $x_\eta \sim_{\epsilon - \eta - \theta} \rcrat(q)$, therefore by
      induction hypothesis $\bar{f}(x_\eta) \sim_{L \epsilon - L \eta - L \theta}
      \rcrat(f(q))$, which proves $\bar{f}(\rclim(x)) \sim_{L \epsilon}
      \bar{f}(\rcrat(q))$.
    \end{itemize}

  \item When $u$ is $\rclim(x)$ and $v$ is $\rclim(y)$ we proceed as follows:
    %
    \begin{itemize}
    \item Preservation of equality: given any $\epsilon : \Qp$, there merely exist
      $\delta, \eta, \theta : \Qp$ such that $x_\delta \sim_{\epsilon/L - \delta - \eta -
        \theta} y_\eta$. By induction hypothesis $\bar{f}(x_\delta) \sim_{\epsilon - L
        \delta - L \eta - L \theta} \bar{f}(y_\eta)$, therefore $\bar{f}(x) \sim_\epsilon
      \bar{f}(y)$.

    \item Lipschitz condition:
      %
      supposing $\rclim(x) \sim_\epsilon \rclim(y)$, there merely exist $\delta, \eta,
      \theta : \Qp$ such that $x_\delta \sim_{\epsilon - \delta - \eta - \theta} y_\eta$,
      therefore by induction hypothesis $\bar{f}(x_\delta) \sim_{L \epsilon - L \delta - L
        \eta - L \theta} \bar{f}(y_\eta)$, which proves $\bar{f}(\rclim(x)) \sim_{L
        \epsilon} \bar{f}(\rclim(y))$.
    \end{itemize}
  \end{enumerate}
\end{proof}

\subsection{Additive structure}
\label{sec:additive-structure-order}

It is tedious to define a function on $\RC$ with bare hands, but we can use (the
multivariate variant of) \autoref{RC-Lipschitz-eq,RC-extend-Q-Lipschitz} to define the
additive and the lattice structure of the reals.

Addition and subtraction are Lipschitz functions on rationals, so they extend to reals and
the extensions satisfy the same equations. This shows that $(\RC, {+}, {-}, 0)$ is a
commutative group.

\begin{thm} \label{RC-commutative-group}
  The Cauchy reals form a commutative group.
\end{thm}

\subsection{Order}
\label{sec:order}

Next, $\min$ and $\max$ are Lipschitz as well, so they can be extended to give $\RC$ the
structure of a lattice, which interacts as expected with the commutative group structure.
The mere binary relation $\leq$, defined for $u, v : \RC$ by
%
\begin{equation*}
  (u \leq v) \defeq \max(u,v) = v
\end{equation*}
%
is a partial order on $\RC$, for which $\min$ and $\max$ are the infimum and supremum. The
strict order $<$ is defined constructively as
%
\begin{equation*}
  (u < v) \defeq
  \exis{q, r : \Q} (q < r) \land (x \leq \rcrat(q)) \land (\rcrat(r) \leq y).
\end{equation*}
%
That is, a witness for $u < v$ is a pair or rational numbers $q < r$ such that $x \leq
\rcrat(q)$ and $\rcrat(r) \leq v$. The strict order is irreflexive and transitive, but we
have to be careful about linearity. We shall address this in \autoref{sec:RC-order}, for
now we focus on expressing $u \sim_\epsilon v$ with standard concepts. Note that the
absolute value $|{-}|$ is a Lipschitz function on $\Q$, which therefore extends to $\RC$
and has the expected properties.

We are now able to show that the auxiliary relation $\sim$ is what we think it is.

\begin{thm} \label{RC-sim-eqv-le}
  $\eqv{(u \sim_\epsilon v)}{(|u - v| < \rcrat(\epsilon))}$
  for all $u, v : \RC$ and $\epsilon : \Qp$.
\end{thm}

\begin{proof}
  TODO
\end{proof}

TODO: Prove or state relevant properties of $<$.

\subsection{The ring structure}
\label{sec:ring-structure}

TODO: Get multiplication working.

\subsection{The field structure}
\label{sec:field-structure}

TODO: Introduce apartness and inverses.

\subsection{Completeness}
\label{sec:completeness-RC}

TODO: State traditional Cauchy completion


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Comparison of Cauchy and Dedekind Reals}
\label{sec:comp-cacuhy-dedek}

Cauchy embeds in Dedekind, we do not expect them to be the same (sheaf model over the
reals) Note, we do not use univalence, hence we have models in sSh(X).

They are the same if we have CAC for Sigma-predicates
Also, $Sigma = 2^N/\sim$.


\subsection{Intuitionstic vs.\ Classical Analysis}
\label{sec:intuitionistic-vs-classical-analysis}

TODO: Example theorems: mean-value theorem.


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "main"
%%% End: 
